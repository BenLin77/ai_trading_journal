# ========== AI API 設定 ==========
# 支援 Google Gemini 或 DeepSeek（二選一，優先使用 DeepSeek）
#
# 雙模型架構：
# - Thinking Model (深度分析): Gemini 2.5 Flash Thinking / DeepSeek Reasoner
#   用於：每日報告、績效評估、策略建議、錯誤分析
# - Fast Model (快速對話): Gemini 2.0 Flash / DeepSeek Chat
#   用於：一般對話、快速回應

# DeepSeek API Key（推薦，費用更低）
# 請到 https://platform.deepseek.com/ 取得 API Key
# 模型：deepseek-chat (Fast) / deepseek-reasoner (Thinking)
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# Google Gemini API Key（備用）
# 請到 https://makersuite.google.com/app/apikey 取得 API Key
# 模型：gemini-2.0-flash (Fast) / gemini-2.5-flash-preview (Thinking)
GEMINI_API_KEY=your_gemini_api_key_here

# ========== 資料來源設定 ==========
# 控制系統如何取得持倉和交易數據
#
# QUERY  - 使用 IBKR Flex Query API (預設，適合非交易時段)
#          需要設定：IBKR_FLEX_TOKEN, IBKR_HISTORY_QUERY_ID, IBKR_POSITIONS_QUERY_ID
#
# GATEWAY - 使用 IB Gateway/TWS 即時連線 (適合交易時段即時監控)
#           需要設定：IB_HOST, IB_PORT, IB_CLIENT_ID
#
DATA_SOURCE=QUERY

# ========== IBKR Flex Query 設定 (DATA_SOURCE=QUERY 時需要) ==========
# 設定指南：https://www.interactivebrokers.com/en/software/am/am/reports/flex_web_service_version_3.htm

# Flex Web Service Token（必填）
# 取得位置：IBKR Portal > Settings > Account Settings > Flex Web Service
IBKR_FLEX_TOKEN=your_flex_token_here

# ---------- Query ID 設定 ----------

# 1. 歷史交易記錄 Query ID（主要）
#    用途：交易記錄匯入、AI 分析、績效統計、現金庫存
#    建議設定：Period = Last 365 days, Format = CSV
#
#    ✅ 必須勾選的區段與欄位：
#
#    [Trades 區段]
#    - Symbol          (標的代號)
#    - TradeDate       (交易日期)
#    - Quantity        (數量)
#    - TradePrice      (成交價格)
#    - IBCommission    (手續費)
#    - AssetClass      (資產類別: STK/OPT/FUT)
#    - Buy/Sell        (買賣方向)
#
#    [選擇權交易需加勾]
#    - Strike          (履約價)
#    - Expiry          (到期日)
#    - Put/Call        (Call 或 Put)
#    - Multiplier      (合約乘數)
#    - UnderlyingSymbol (標的股票代號)
#
#    [Cash Report 區段] - 現金餘額必須！
#    - EndingCash          (期末現金)
#    - EndingSettledCash   (期末已結算現金)
#    - CurrencyPrimary     (幣別，建議)
#
#    [建議加勾]
#    - DateTime, Proceeds, FifoPnlRealized, Open/CloseIndicator
#
IBKR_HISTORY_QUERY_ID=your_history_query_id

# 2. 當前持倉快照 Query ID
#    用途：即時持倉分析、風險暴露計算
#    建議設定：Period = Today, Format = CSV
#
#    ✅ 必須勾選的區段與欄位：
#
#    [Open Positions 區段]
#    - Symbol          (標的代號)
#    - Quantity        (持倉數量)
#    - MarkPrice       (市價)
#    - CostBasisPrice  (成本價)
#    - AssetClass      (資產類別)
#
#    [選擇權持倉需加勾]
#    - Strike          (履約價)
#    - Expiry          (到期日)
#    - Put/Call        (Call 或 Put)
#    - Multiplier      (合約乘數)
#    - UnderlyingSymbol (標的股票代號)
#    - FifoPnlUnrealized (未實現盈虧)
#
IBKR_POSITIONS_QUERY_ID=your_positions_query_id

# ========== IB Gateway 連線設定 (DATA_SOURCE=GATEWAY 時需要) ==========
# IB Gateway 預設端口: 4001 (Live), 4002 (Paper)
# TWS 預設端口: 7496 (Live), 7497 (Paper)
IB_HOST=127.0.0.1
IB_PORT=4001
IB_CLIENT_ID=1

# ========== 每日報告排程設定 ==========
# 報告發送時間 (24小時制，使用 Asia/Taipei 時區)
# 這兩個變數可透過前端設定頁面調整
REPORT_TIME_HOUR=08
REPORT_TIME_MINUTE=30

# ========== Telegram 通知設定 ==========
# Bot Token: 從 @BotFather 取得
# Chat ID: 發送訊息給 bot 後，訪問 https://api.telegram.org/bot<TOKEN>/getUpdates 取得
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here

# ========== 環境設定 ==========
# 環境類型：development / production
# 生產環境會：禁用 API 文檔、啟用安全 headers、限制 CORS 來源
ENVIRONMENT=development
NODE_ENV=development

# ========== API 限額控制（安全措施 #8）==========
# AI API 每日請求上限（防止費用超支）
AI_DAILY_LIMIT=100

# AI API 每小時請求上限
AI_HOURLY_LIMIT=20

# 一般 API 每分鐘請求上限
API_RATE_LIMIT=60

# ========== 監控設定（安全措施 #6）==========
# Sentry DSN（錯誤追蹤）
# 請到 https://sentry.io/ 取得
# SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx

# ========== 其他安全設定 ==========
# JWT Secret Key（如果有使用 JWT 認證）
# JWT_SECRET_KEY=your_very_long_and_random_secret_key_here

# API Key（如果想為 API 加上額外的保護層）
# API_SECRET_KEY=your_api_secret_key_here

