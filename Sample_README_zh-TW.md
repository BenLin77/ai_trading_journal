# WAIT - Windows Automation Image Tool v2.0

**ç¹é«”ä¸­æ–‡å®Œæ•´æŠ€è¡“æ–‡ä»¶**

ğŸ“– **[Deployment Guide (English)](docs/DEPLOY_GUIDE.md)** | **[éƒ¨ç½²æŒ‡å—ï¼ˆç¹é«”ä¸­æ–‡ï¼‰](docs/DEPLOY_GUIDE_zh-TW.md)**

---

## ğŸ“‹ ç›®éŒ„

- [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)
- [æ ¸å¿ƒæ¨¡çµ„è©³è§£](#æ ¸å¿ƒæ¨¡çµ„è©³è§£)
- [è³‡æ–™æµç¨‹](#è³‡æ–™æµç¨‹)
- [Web UI æ¶æ§‹](#web-ui-æ¶æ§‹)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [é–‹ç™¼æŒ‡å—](#é–‹ç™¼æŒ‡å—)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ç³»çµ±æ¦‚è¿°

WAIT æ˜¯ä¸€å€‹è‡ªå‹•åŒ– Windows æ˜ åƒæª”å»ºç½®ç³»çµ±ï¼Œæ¡ç”¨**å¾®æœå‹™æ¶æ§‹**è¨­è¨ˆï¼Œå°‡æ˜ åƒæª”å»ºç½®æµç¨‹æ‹†åˆ†ç‚ºå¤šå€‹ç¨ç«‹æœå‹™ï¼Œæä¾› RESTful API å’Œç¾ä»£åŒ– Web UI ä»‹é¢ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… è‡ªå‹•åŒ– Windows WIM æ˜ åƒæª”å»ºç½®
- âœ… æ™ºæ…§å‹ä¸»æ©Ÿæ¿é©…å‹•ç¨‹å¼åŒ¹é…
- âœ… å¤šå®¢æˆ¶å‘½åç®¡ç†
- âœ… å…ƒä»¶æ¨¡çµ„åŒ–æ•´åˆï¼ˆé©…å‹•ã€æ›´æ–°ã€èªè¨€åŒ…ï¼‰
- âœ… å…©éšæ®µå»ºç½®èˆ‡é©—è­‰æµç¨‹
- âœ… RESTful API èˆ‡ Web UI
- âœ… å³æ™‚ç‹€æ…‹ç›£æ§
- âœ… ISO æ”¯æ´ - æ”¯æ´ `.iso` ä¾†æºä¸¦å¯é‡æ–°å°è£ç‚ºå¯é–‹æ©Ÿ ISO æª”ã€‚
- âœ… è‡ªå‹•å®¹éŒ¯ (Soft-Fail) - é©…å‹•ä¸‹è¼‰å¤±æ•—è‡ªå‹•é™ç´šç‚ºè­¦å‘Šï¼Œç¢ºä¿å»ºç½®ä¸ä¸­æ–·ã€‚
- âœ… å®‰å…¨å–æ¶ˆæ©Ÿåˆ¶ - é˜²æ­¢ä¸­é€”å–æ¶ˆå°è‡´çš„ç³»çµ±é–å®šï¼Œä¸¦å…·å‚™æ›è¼‰éŒ¯èª¤ (0xc1420127) è‡ªå‹•ä¿®å¾©åŠŸèƒ½ã€‚
- âœ… è³‡æºè·¯å¾‘è¿½è¹¤ - è¨˜éŒ„é©…å‹•ã€èªè¨€åŒ…ã€æ›´æ–°ã€è»Ÿé«”è·¯å¾‘ï¼Œæ”¯æ´æ˜ åƒé‡æ–°ç”¢ç”Ÿ
- âœ… å®Œæ•´å¯é‡ç¾æ€§ - é€é job_id æŸ¥è©¢æ‰€æœ‰è³‡æºé…ç½®ï¼Œå¿«é€Ÿé‡å»ºç›¸åŒæ˜ åƒ

### æŠ€è¡“æ£§

**å¾Œç«¯ï¼š**

- Python 3.8+
- Flask (REST API)
- SQLAlchemy (ORM)
- SQLite (è³‡æ–™åº«)

**å‰ç«¯ï¼š**

- React 18 + TypeScript
- Vite (å»ºç½®å·¥å…·)
- Tailwind CSS v3 (UI æ¡†æ¶)
- TanStack Query (ç‹€æ…‹ç®¡ç†)
- React Router v6 (è·¯ç”±)

---

## ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½¿ç”¨è€…å±¤                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Web Browser â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ REST API å®¢æˆ¶ â”‚            â”‚
â”‚  â”‚  (React UI)  â”‚  HTTP/JSON   â”‚  (Python/JS)  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                              â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚
          â”‚         HTTP (port 5000)     â”‚
          â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Server (Flask)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ REST API ç«¯é» (/api/*)                           â”‚   â”‚
â”‚  â”‚  â€¢ å‰ç«¯éœæ…‹æª”æ¡ˆæœå‹™ (/)                             â”‚   â”‚
â”‚  â”‚  â€¢ CORS è™•ç†                                         â”‚   â”‚
â”‚  â”‚  â€¢ è«‹æ±‚é©—è­‰èˆ‡å›æ‡‰æ ¼å¼åŒ–                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                â”‚
             â”‚  Database I/O                  â”‚
             â–¼                                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SQLite DB      â”‚          â”‚  æª”æ¡ˆç³»çµ±            â”‚
    â”‚  (wait.db)      â”‚          â”‚  â€¢ 2_Drivers/       â”‚
    â”‚                 â”‚          â”‚  â€¢ 0_BaseImages/    â”‚
    â”‚  Tables:        â”‚          â”‚  â€¢ 4_Updates/       â”‚
    â”‚  â€¢ build_jobs   â”‚          â”‚  â€¢ 3_LangPacks/     â”‚
    â”‚  â€¢ motherboards â”‚          â”‚  â€¢ output/          â”‚
    â”‚  â€¢ components   â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–²
             â”‚  Database I/O
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Background Workers                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Build Processor            â”‚   Validation Processor        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. ç›£æ§ Queued ç‹€æ…‹  â”‚   â”‚  â”‚ 1. ç›£æ§ Pending ç‹€æ…‹ â”‚    â”‚
â”‚  â”‚ 2. è¼‰å…¥ WIM          â”‚   â”‚  â”‚ 2. é©—è­‰æ˜ åƒæª”         â”‚    â”‚
â”‚  â”‚ 3. æ³¨å…¥é©…å‹•ç¨‹å¼      â”‚   â”‚  â”‚ 3. æª¢æŸ¥ Manifest     â”‚    â”‚
â”‚  â”‚ 4. å¥—ç”¨æ›´æ–°æª”        â”‚   â”‚  â”‚ 4. æ›´æ–° Job ç‹€æ…‹     â”‚    â”‚
â”‚  â”‚ 5. å®‰è£èªè¨€åŒ…        â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚ 6. å¯«å…¥ Product Key  â”‚   â”‚                               â”‚
â”‚  â”‚ 7. å„²å­˜æ˜ åƒæª”        â”‚   â”‚  æ¯ 10 ç§’è¼ªè©¢ä¸€æ¬¡             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                               â”‚
â”‚                              â”‚                               â”‚
â”‚  æ¯ 5 ç§’è¼ªè©¢ä¸€æ¬¡             â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœå‹™é€šè¨Šæµç¨‹

```
[ä½¿ç”¨è€…] â”€â”€HTTP POSTâ”€â”€> [API Server]
                             â”‚
                             â”œâ”€â”€CREATEâ”€â”€â”€â”€â”€> [Database]
                             â”‚                  â”‚
                             â”‚                  â”‚ status='Queued'
                             â”‚                  â”‚
                             â–¼                  â–¼
                        å›å‚³ job_id        [build_jobs table]
                                                â”‚
                                                â”‚ è¼ªè©¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚  [Build Processor] â”€â”€SELECTâ”€â”€ [Database (status='Queued')]
â”‚         â”‚
â”‚         â”œâ”€â”€ UPDATE status='Processing_Build'
â”‚         â”‚
â”‚         â”œâ”€â”€ åŸ·è¡Œå»ºç½®æµç¨‹
â”‚         â”‚   â”œâ”€â”€ è¼‰å…¥ Base Image
â”‚         â”‚   â”œâ”€â”€ æ›è¼‰ WIM
â”‚         â”‚   â”œâ”€â”€ æ³¨å…¥å…ƒä»¶
â”‚         â”‚   â””â”€â”€ å„²å­˜æ˜ åƒæª”
â”‚         â”‚
â”‚         â”œâ”€â”€ UPDATE status='Pending_Validation'
â”‚         â”‚
â”‚         â””â”€â”€ å»ºç½®å®Œæˆ
â”‚
â”‚  [Validation Processor] â”€â”€SELECTâ”€â”€ [Database (status='Pending_Validation')]
â”‚         â”‚
â”‚         â”œâ”€â”€ UPDATE status='Processing_Validation'
â”‚         â”‚
â”‚         â”œâ”€â”€ åŸ·è¡Œé©—è­‰æµç¨‹
â”‚         â”‚   â”œâ”€â”€ æª¢æŸ¥æ˜ åƒæª”å®Œæ•´æ€§
â”‚         â”‚   â”œâ”€â”€ é©—è­‰ Manifest
â”‚         â”‚   â””â”€â”€ ç¢ºèªå…ƒä»¶å®‰è£
â”‚         â”‚
â”‚         â”œâ”€â”€ UPDATE status='Verified' æˆ– 'Failed_Validation'
â”‚         â”‚
â”‚         â””â”€â”€ é©—è­‰å®Œæˆ
â”‚
â””â”€â”€> [Web UI] â”€â”€HTTP GET /api/jobsâ”€â”€ (æ¯ 5 ç§’è‡ªå‹•åˆ·æ–°)
              é¡¯ç¤ºå³æ™‚ç‹€æ…‹
```

---

## ç›®éŒ„çµæ§‹

```
WAIT_Project/                     # å°ˆæ¡ˆæ ¹ç›®éŒ„
â”‚
â”œâ”€â”€ win_imagebuilder/             # ç¨‹å¼ç¢¼ç›®éŒ„
â”‚   â”œâ”€â”€ api/                      # API æœå‹™å±¤
â”‚   â”‚   â”œâ”€â”€ server.py             # Flask REST API ä¸»ç¨‹å¼
â”‚   â”‚   â”œâ”€â”€ common.py             # å…±äº«å·¥å…·å‡½å¼
â”‚   â”‚   â””â”€â”€ routes/               # API è·¯ç”±æ¨¡çµ„
â”‚   â”‚       â”œâ”€â”€ job.py            # å–®ä¸€ä»»å‹™ç«¯é»
â”‚   â”‚       â”œâ”€â”€ job_clone.py      # ä»»å‹™æ­·å²ã€æœå°‹èˆ‡è¤‡è£½
â”‚   â”‚       â”œâ”€â”€ resources.py      # è³‡æºæƒæç«¯é»
â”‚   â”‚       â”œâ”€â”€ outputs.py        # æ§‹å»ºæ˜ åƒï¼ˆè¼¸å‡ºï¼‰ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ webhooks.py       # Webhook ç®¡ç†ç«¯é»
â”‚   â”‚       â””â”€â”€ streaming.py      # SSE æ—¥èªŒä¸²æµç«¯é»
â”‚   â”‚
    â”‚   â”œâ”€â”€ database/                 # è³‡æ–™åº«å±¤
    â”‚   â”‚   â”œâ”€â”€ operations.py         # è³‡æ–™åº«æ“ä½œï¼ˆCRUDï¼‰
    â”‚   â”‚   â””â”€â”€ models.py             # SQLAlchemy ORM æ¨¡å‹å®šç¾©ï¼ˆ4å€‹è¡¨ï¼šusers, build_jobs, job_logs, webhooksï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ workers/                  # èƒŒæ™¯å·¥ä½œè™•ç†å™¨
â”‚   â”‚   â”œâ”€â”€ build_processor.py    # å»ºç½®è™•ç†å™¨ï¼ˆä¸»è¦å»ºç½®é‚è¼¯ï¼‰
â”‚   â”‚   â””â”€â”€ validation_processor.py # é©—è­‰è™•ç†å™¨ï¼ˆæ˜ åƒæª”é©—è­‰ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ wim_operations.py     # WIM æª”æ¡ˆæ“ä½œï¼ˆæ›è¼‰ã€æ³¨å…¥ã€å¸è¼‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ iso_handler.py        # ISO æ›è¼‰èˆ‡ WIM æå–
â”‚   â”‚   â””â”€â”€ dism_wrapper.py       # DISM æ“ä½œå°è£
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                   # è¨­å®šæª”
â”‚   â”‚   â””â”€â”€ settings.py           # ç³»çµ±è¨­å®š
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                      # React å‰ç«¯å°ˆæ¡ˆ
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/       # React å…ƒä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ui/           # UI åŸºç¤å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/            # é é¢å…ƒä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Jobs.tsx      # Jobs åˆ—è¡¨é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts        # API å®¢æˆ¶ç«¯
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ utils.ts      # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ api.ts        # TypeScript é¡å‹å®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ App.tsx           # React æ ¹å…ƒä»¶
â”‚   â”‚   â”‚   â””â”€â”€ main.tsx          # React å…¥å£é»
â”‚   â”‚   â”œâ”€â”€ package.json          # Node.js ä¾è³´ç®¡ç†
â”‚   â”‚   â””â”€â”€ vite.config.ts        # Vite è¨­å®š
â”‚   â”‚
â”‚   â”œâ”€â”€ init_db.py                # è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
â”‚   â”œâ”€â”€ migrate_database.py       # è³‡æ–™åº«é·ç§»è…³æœ¬ï¼ˆv2.4 â†’ v2.6ï¼‰
â”‚   â”œâ”€â”€ requirements.txt          # Python å¥—ä»¶ä¾è³´
â”‚   â”œâ”€â”€ start_all.bat             # Windows ä¸€éµå•Ÿå‹•è…³æœ¬
â”‚   â”œâ”€â”€ deploy_web.bat            # Web UI éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ README.md                 # å°ˆæ¡ˆæ–‡ä»¶ï¼ˆè‹±æ–‡ï¼‰
â”‚   â””â”€â”€ README_zh-TW.md           # å°ˆæ¡ˆæ–‡ä»¶ï¼ˆç¹é«”ä¸­æ–‡ï¼‰
â”‚
â””â”€â”€ WAIT_Repository/              # è³‡æ–™å„²å­˜åº«ç›®éŒ„ï¼ˆèˆ‡ç¨‹å¼ç¢¼å¹³è¡Œï¼‰
    â”œâ”€â”€ 1_BaseImages/             # åŸºç¤æ˜ åƒæª”ç›®éŒ„ï¼ˆæ”¯æ´ ISO/WIM é›™æ ¼å¼ï¼‰
    â”‚   â”œâ”€â”€ WINDOWS11_IOT_LTSC_24H2_EN_US_X64.iso    # Windows 11 24H2
    â”‚   â”œâ”€â”€ WINDOWS11_IOT_LTSC_24H2_EN_US_X64.wim    # Windows 11 24H2
    â”‚   â”œâ”€â”€ WINDOWS10_IOT_LTSC_21H2_EN_US_X64.iso    # Windows 10 21H2
    â”‚   â””â”€â”€ WINDOWS10_IOT_LTSC_21H2_EN_US_X64.wim    # Windows 10 21H2
    â”‚
    â”œâ”€â”€ 2_Drivers/                # é©…å‹•ç¨‹å¼ç›®éŒ„ï¼ˆæŒ‰ä¸»æ©Ÿæ¿å‹è™Ÿ â†’ Windows ç‰ˆæœ¬ï¼‰
    â”‚   â”œâ”€â”€ X13SAW/
    â”‚   â”‚   â””â”€â”€ WINDOWS11_X64/
    â”‚   â”‚       â”œâ”€â”€ chipset/
    â”‚   â”‚       â”œâ”€â”€ network/
    â”‚   â”‚       â””â”€â”€ storage/
    â”‚   â”œâ”€â”€ X13SRN-H-WOHS/
    â”‚   â”‚   â””â”€â”€ WINDOWS11_X64/
    â”‚   â””â”€â”€ x13_up/
    â”‚       â””â”€â”€ WINDOWS11_X64/
    â”‚
    â”œâ”€â”€ 3_LangPacks/              # èªè¨€åŒ…ç›®éŒ„ï¼ˆæŒ‰ Windows ç‰ˆæœ¬çµ„ç¹”ï¼‰
    â”‚   â”œâ”€â”€ WIN11_IOT_24H2_X64/
    â”‚   â”‚   â””â”€â”€ *.cab
    â”‚   â””â”€â”€ WIN10_IOT_21H2_X64/
    â”‚       â””â”€â”€ *.cab
    â”‚
    â”œâ”€â”€ 4_Updates/                # Windows æ›´æ–°æª”ç›®éŒ„ï¼ˆæŒ‰å®¢æˆ¶/å°ˆæ¡ˆ â†’ Windows ç‰ˆæœ¬ï¼‰
    â”‚   â””â”€â”€ [customer]/
    â”‚       â”œâ”€â”€ WIN11_24H2/
    â”‚       â”‚   â””â”€â”€ *.msu, *.cab
    â”‚       â””â”€â”€ WIN10_21H2/
    â”‚           â””â”€â”€ *.msu, *.cab
    â”‚
    â”œâ”€â”€ 5_AnswerFiles/            # æ‡‰ç­”æª”ç›®éŒ„ï¼ˆæŒ‰ä¸»æ©Ÿæ¿å‹è™Ÿ â†’ Windows ç‰ˆæœ¬ï¼‰
    â”‚   â””â”€â”€ X13SAW/
    â”‚       â””â”€â”€ WIN11_24H2/
    â”‚           â””â”€â”€ autounattend.xml
    â”‚
    â”œâ”€â”€ 6_Software/               # è»Ÿé«”å¥—ä»¶ç›®éŒ„ï¼ˆæŒ‰å®¢æˆ¶/å°ˆæ¡ˆ â†’ Windows ç‰ˆæœ¬ï¼‰
    â”‚   â””â”€â”€ [customer]/
    â”‚       â”œâ”€â”€ WIN11_24H2/
    â”‚       â”‚   â””â”€â”€ *.exe, *.msi, *.appx, *.msix
    â”‚       â””â”€â”€ WIN10_21H2/
    â”‚           â””â”€â”€ *.exe, *.msi
    â”‚
    â”œâ”€â”€ 7_Tools/                  # å¤–éƒ¨å·¥å…·ç›®éŒ„ï¼ˆoscdimg ç­‰ï¼‰
    â”‚   â””â”€â”€ oscdimg/
    â”‚       â””â”€â”€ oscdimg.exe
    â”‚
    â””â”€â”€ 8_Output/                 # è¼¸å‡ºç›®éŒ„ï¼ˆæŒ‰å®¢æˆ¶ â†’ æ™‚é–“æˆ³è¨˜_ä¸»æ©Ÿæ¿å‹è™Ÿï¼‰
        â””â”€â”€ AABBCCE/
            â””â”€â”€ 20251112_090645_X13SAW/
                â”œâ”€â”€ install.wim
                â”œâ”€â”€ manifest.txt
                â””â”€â”€ checksum.md5
```

---

## API æ–‡ä»¶

å®Œæ•´çš„ API æ–‡ä»¶å·²ç¨ç«‹è‡³ä»¥ä¸‹æª”æ¡ˆï¼Œè«‹åƒè€ƒï¼š

- **[API_ENDPOINT_zh-TW.md](docs/API_ENDPOINT_zh-TW.md)** - ç¹é«”ä¸­æ–‡å®Œæ•´ API åƒè€ƒï¼ˆå«æ™ºæ…§éæ¿¾ï¼‰
- **[API_ENDPOINT.md](docs/API_ENDPOINT.md)** - English API Reference (with Smart Filtering)

> ğŸ” **éœ€è¦å…ˆç™»å…¥**ï¼šæ‰€æœ‰ `/api/job*`ã€`/api/queue`ã€`/api/jobs*` ç«¯é»çš†éœ€æœ‰æ•ˆ Sessionã€‚è«‹å…ˆå‘¼å« `POST /api/auth/login`ï¼ˆBody ç¯„ä¾‹ï¼š`{"username": "admin", "password": "***"}`ï¼‰ï¼Œå–å¾—çš„ Cookie å¿…é ˆåœ¨å¾ŒçºŒè«‹æ±‚ä¸­ä¸€ä½µé€å‡ºï¼Œå¦å‰‡æœƒæ”¶åˆ° 401ã€‚

> âš ï¸ **å–®ä¸€ä»»å‹™æ¨¡å¼**ï¼šWAIT ç¾åœ¨ä»¥å–®ä¸€ä»»å‹™åŸ·è¡Œæ¨¡å¼é‹ä½œã€‚åŒä¸€æ™‚é–“åªèƒ½æœ‰ä¸€å€‹ä»»å‹™åœ¨è™•ç†ï¼Œå…¶ä»–ä»»å‹™æœƒåœ¨ä½‡åˆ—ä¸­ç­‰å¾…ã€‚

åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š

- **å–®ä»»å‹™ API**ï¼ˆä¸»è¦ä»‹é¢ï¼‰- 7 å€‹ç«¯é»
  - `POST /api/job` - å»ºç«‹ä»»å‹™ï¼ˆè‹¥æœ‰å…¶ä»–ä»»å‹™å‰‡æ’éšŠï¼‰
  - `GET /api/job` - å–å¾—ç•¶å‰/æœ€è¿‘ä»»å‹™ç‹€æ…‹
  - `GET /api/queue` - â­ **æ–°å¢**ï¼šåˆ—å‡ºæ‰€æœ‰æ’éšŠä¸­çš„ä»»å‹™
  - `GET /api/job/stream` - ä¸²æµæ—¥èªŒï¼ˆSSEï¼‰
  - `GET /api/job/manifest` - å–å¾— Manifest
  - `POST /api/job/cancel` - å–æ¶ˆä»»å‹™
  - `DELETE /api/job` - åˆªé™¤ä»»å‹™
- **Webhook API** - å»ºç«‹/åˆ—è¡¨/æ›´æ–°/åˆªé™¤ Webhook é€šçŸ¥
- **è³‡æº API** - æƒæå¯ç”¨è³‡æºèˆ‡é©—è­‰è¼¸å…¥
- **ç³»çµ± API** - å¥åº·æª¢æŸ¥
- å®Œæ•´ç¯„ä¾‹èˆ‡å·¥ä½œæµ

---

## æ ¸å¿ƒæ¨¡çµ„è©³è§£

### 1. API Server (`api/server.py`)

**è·è²¬ï¼š** RESTful API æœå‹™èˆ‡å‰ç«¯æª”æ¡ˆæœå‹™

è©³ç´° API ç«¯é»èªªæ˜è«‹åƒè€ƒ [API æ–‡ä»¶](docs/API_ENDPOINT_zh-TW.md)ã€‚

---

### 2. Database Layer (`database/`)

#### è³‡æ–™æ¨¡å‹ (`models.py`)

å®šç¾© SQLAlchemy ORM è³‡æ–™æ¨¡å‹ï¼ŒåŒ…å«å››å€‹ä¸»è¦è³‡æ–™è¡¨ï¼š

- **User** - ä½¿ç”¨è€…å¸³è™Ÿè¡¨ï¼Œç”¨æ–¼èº«ä»½é©—è­‰èˆ‡æˆæ¬Šï¼Œè¿½è¹¤ä»»å‹™å»ºç«‹è€…èˆ‡ Webhook æ“æœ‰è€…
- **BuildJob** - å»ºç½®ä»»å‹™ä¸»è¡¨ï¼Œè¿½è¹¤ä»»å‹™ç‹€æ…‹ã€è³‡æºè·¯å¾‘ã€è¼¸å‡ºè·¯å¾‘ã€æ™‚é–“æˆ³è¨˜èˆ‡å»ºç«‹è€…è³‡è¨Š
- **JobLog** - ä»»å‹™æ—¥èªŒè¡¨ï¼Œå„²å­˜çµæ§‹åŒ–ã€æ™‚é–“æˆ³è¨˜çš„æ—¥èªŒè¨Šæ¯ï¼Œæ”¯æ´æ—¥èªŒç­‰ç´šéæ¿¾ï¼ˆnormal/verboseï¼‰
- **Webhook** - Webhook ç«¯é»è¡¨ï¼Œç®¡ç†å¤–éƒ¨é€šçŸ¥è¨­å®šã€äº‹ä»¶è¨‚é–±èˆ‡å»ºç«‹è€…è³‡è¨Š

#### ä»»å‹™ç‹€æ…‹æµè½‰

```
Queued                    # å·²æ’éšŠï¼Œç­‰å¾…å»ºç½®
    â†“
Processing_Build          # å»ºç½®ä¸­
    â†“
    â”œâ”€â”€ Failed_Build      # å»ºç½®å¤±æ•—ï¼ˆå¯é‡è©¦ï¼‰
    â”‚       â†“ (retry)
    â”‚   Queued
    â”‚
    â””â”€â”€ Pending_Validation  # ç­‰å¾…é©—è­‰
            â†“
        Processing_Validation  # é©—è­‰ä¸­
            â†“
            â”œâ”€â”€ Failed_Validation  # é©—è­‰å¤±æ•—ï¼ˆå¯é‡è©¦ï¼‰
            â”‚       â†“ (retry)
            â”‚   Queued
            â”‚
            â””â”€â”€ Completed    # é©—è­‰é€šéï¼ˆæœ€çµ‚ç‹€æ…‹ï¼‰
```

**æ³¨æ„ï¼š** `Verified` ç‚ºèˆŠç‰ˆç‹€æ…‹ï¼Œä¿ç•™ä»¥ç¶­æŒç›¸å®¹æ€§ã€‚æ–°ä»»å‹™ä½¿ç”¨ `Completed` ä½œç‚ºæœ€çµ‚æˆåŠŸç‹€æ…‹ã€‚

#### è³‡æ–™åº«ç®¡ç†å™¨ (`operations.py`)

**DatabaseManager æä¾›çš„ CRUD æ“ä½œï¼š**

**`create_build_job()`** - å‰µå»ºå»ºç½®ä»»å‹™

- é©—è­‰åƒæ•¸ä¸¦å‰µå»º BuildJob è¨˜éŒ„
- è¨­å®šåˆå§‹ç‹€æ…‹ç‚º 'Queued'
- å›å‚³ job_id

**`get_job(job_id)`** - æŸ¥è©¢å–®ä¸€ä»»å‹™

- æ ¹æ“š job_id æŸ¥è©¢ä»»å‹™
- åŒ…å«æ‰€æœ‰ä»»å‹™è©³ç´°è³‡è¨Š

**`get_jobs_by_status(status, limit, offset)`** - ä¾ç‹€æ…‹æŸ¥è©¢ä»»å‹™

- æŸ¥è©¢ç‰¹å®šç‹€æ…‹çš„ä»»å‹™åˆ—è¡¨
- æ”¯æ´åˆ†é åŠŸèƒ½ï¼ˆlimit èˆ‡ offsetï¼‰

**`update_job_status(job_id, status, log_message)`** - æ›´æ–°ä»»å‹™ç‹€æ…‹

- è‡ªå‹•æ›´æ–° updated_at æ™‚é–“æˆ³è¨˜
- è‹¥ç‹€æ…‹ç‚º Processing_*ï¼Œè¨­å®š started_at
- è‹¥ç‹€æ…‹ç‚º Verified/Failed_*ï¼Œè¨­å®š completed_at

**`delete_job(job_id)`** - åˆªé™¤ä»»å‹™

- ç´šè¯åˆªé™¤é—œè¯çš„ logs

---

### 3. Build Processor (`workers/build_processor.py`)

**è·è²¬ï¼š** åŸ·è¡Œ Windows æ˜ åƒæª”å»ºç½®æµç¨‹

#### ä¸»è¦æµç¨‹

**Build Processor åŸ·è¡Œå¾ªç’°ï¼š**

1. **æŸ¥è©¢å¾…è™•ç†ä»»å‹™** - å¾è³‡æ–™åº«æŸ¥è©¢ç‹€æ…‹ç‚º 'Queued' çš„ä»»å‹™
2. **æ›´æ–°ç‹€æ…‹** - å°‡ä»»å‹™ç‹€æ…‹æ›´æ–°ç‚º 'Processing_Build'
3. **åŸ·è¡Œå»ºç½®æµç¨‹** - å‘¼å« `process_build_job()` åŸ·è¡Œå®Œæ•´å»ºç½®
4. **è™•ç†çµæœ**ï¼š
   - æˆåŠŸï¼šæ›´æ–°ç‹€æ…‹ç‚º 'Pending_Validation'ï¼Œé€²å…¥é©—è­‰éšæ®µ
   - å¤±æ•—ï¼šå‘¼å« `handle_build_failure()` è™•ç†éŒ¯èª¤
5. **ç•°å¸¸è™•ç†** - æ•ç²ç•°å¸¸ä¸¦è¨˜éŒ„éŒ¯èª¤è¨Šæ¯
6. **ä¼‘çœ ** - è‹¥ç„¡ä»»å‹™å‰‡ä¼‘çœ  5 ç§’å¾Œç¹¼çºŒ

#### å»ºç½®æ­¥é©Ÿè©³è§£

**`process_build_job()` åŸ·è¡Œçš„å®Œæ•´å»ºç½®æµç¨‹ï¼š**

1. **æº–å‚™å·¥ä½œç›®éŒ„** - å‰µå»ºè‡¨æ™‚æ›è¼‰é»ï¼ˆmnt/ï¼‰å’Œè¼¸å‡ºç›®éŒ„ï¼ˆ7_Output/[customer]/[timestamp]_Job[id]/ï¼‰
2. **è¼‰å…¥åŸºç¤æ˜ åƒæª”** - å¾ 1_BaseImages/ è¤‡è£½ install.wim ä¸¦é©—è­‰æª”æ¡ˆå®Œæ•´æ€§ï¼ˆMD5ï¼‰
3. **æ›è¼‰ WIM æ˜ åƒæª”** - ä½¿ç”¨ DISM å°‡æ˜ åƒæª”å…§å®¹æ›è¼‰åˆ° mnt/ ç›®éŒ„
4. **æ³¨å…¥é©…å‹•ç¨‹å¼** - å¾ 2_Drivers/[motherboard_model]/driver/ éè¿´å®‰è£æ‰€æœ‰ .inf é©…å‹•
5. **å¥—ç”¨æ›´æ–°æª”** - å¾æŒ‡å®šè·¯å¾‘å®‰è£ Windows æ›´æ–°æª”ï¼ˆ.msuï¼‰
6. **å®‰è£èªè¨€åŒ…** - å®‰è£èªè¨€åŒ…ï¼ˆ.cabï¼‰ä¸¦åŒæ™‚è™•ç† WinRE.wimï¼ˆWindows ä¿®å¾©ç’°å¢ƒï¼‰
7. **å¯«å…¥ç”¢å“é‡‘é‘°** - è‹¥æœ‰æä¾› product_keyï¼Œä½¿ç”¨ DISM å¯«å…¥é‡‘é‘°
8. **æ¸…ç†èˆ‡æœ€ä½³åŒ–** - åŸ·è¡Œå…ƒä»¶æ¸…ç†ï¼Œç§»é™¤éæœŸå…ƒä»¶ï¼Œæ¸›å°‘æ˜ åƒæª”å¤§å°
9. **å¸è¼‰ä¸¦å„²å­˜** - å°‡æ‰€æœ‰è®Šæ›´æäº¤ä¸¦å¯«å› install.wim
10. **ç”Ÿæˆ Manifest** - è¨˜éŒ„å®‰è£çš„å…ƒä»¶æ¸…å–®ä¸¦å„²å­˜ç‚º manifest.txt
11. **ç”Ÿæˆ Checksum** - è¨ˆç®— MD5 ä¸¦å„²å­˜ç‚º checksum.md5
12. **æ›´æ–°è³‡æ–™åº«** - è¨­å®š output_image_pathã€manifest_pathã€checksum_path

**å›å‚³å€¼ï¼š** Trueï¼ˆæˆåŠŸï¼‰æˆ– Falseï¼ˆå¤±æ•—ï¼‰

#### éŒ¯èª¤è™•ç†èˆ‡é‡è©¦

**`handle_build_failure()` è™•ç†å»ºç½®å¤±æ•—æµç¨‹ï¼š**

1. å¢åŠ ä»»å‹™çš„ retry_count è¨ˆæ•¸å™¨
2. æª¢æŸ¥æ˜¯å¦è¶…éæœ€å¤§é‡è©¦æ¬¡æ•¸ï¼ˆé è¨­ 3 æ¬¡ï¼‰
3. è‹¥æœªè¶…éæœ€å¤§æ¬¡æ•¸ï¼š
   - å°‡ç‹€æ…‹é‡è¨­ç‚º 'Queued'
   - ä»»å‹™å°‡åœ¨ä¸‹æ¬¡è¼ªè©¢æ™‚é‡æ–°è™•ç†
4. è‹¥å·²è¶…éæœ€å¤§æ¬¡æ•¸ï¼š
   - å°‡ç‹€æ…‹è¨­ç‚º 'Failed_Build'
   - è¨˜éŒ„éŒ¯èª¤è¨Šæ¯åˆ° log_message

---

### 4. Validation Processor (`workers/validation_processor.py`)

**è·è²¬ï¼š** é©—è­‰å»ºç½®å®Œæˆçš„æ˜ åƒæª”

**é‹ä½œæ–¹å¼ï¼š** ä½œç‚ºç¨ç«‹çš„èƒŒæ™¯å·¥ä½œè™•ç†å™¨ï¼ŒæŒçºŒè¼ªè©¢è³‡æ–™åº«ä¸­ç‹€æ…‹ç‚º `Pending_Validation` çš„ä»»å‹™

#### é©—è­‰æµç¨‹

**`process_validation_job()` åŸ·è¡Œçš„æ˜ åƒæª”é©—è­‰æµç¨‹ï¼š**

1. **æª¢æŸ¥è¼¸å‡ºæª”æ¡ˆå­˜åœ¨** - ç¢ºèª install.wimã€manifest.txtã€checksum.md5 æª”æ¡ˆéƒ½å­˜åœ¨
2. **æª¢æŸ¥æª”æ¡ˆå®Œæ•´æ€§** - ä½¿ç”¨ checksum.md5 é©—è­‰ MD5 é›œæ¹Šå€¼ï¼Œç¢ºèªæª”æ¡ˆå¤§å°åˆç†ï¼ˆ> 2GBï¼‰
3. **é©—è­‰æ˜ åƒæª”çµæ§‹** - ä½¿ç”¨ DISM å–å¾—æ˜ åƒæª”è³‡è¨Šï¼Œç¢ºèªå¯æ­£å¸¸è®€å–ä¸¦æª¢æŸ¥ Index æ•¸é‡
4. **é©—è­‰ Manifest å…§å®¹** - è§£æ manifest.txtï¼Œç¢ºèªè¨˜éŒ„çš„å…ƒä»¶æ¸…å–®å®Œæ•´
5. **é©—è­‰å…ƒä»¶å®‰è£** - ä½¿ç”¨ DISM åˆ—å‡ºå·²å®‰è£å¥—ä»¶ï¼Œæ¯”å° Manifest ä¸­çš„å…ƒä»¶æ˜¯å¦éƒ½å·²å®‰è£
6. **é©—è­‰é©…å‹•ç¨‹å¼** - ä½¿ç”¨ DISM æª¢æŸ¥å·²å®‰è£çš„é©…å‹•ç¨‹å¼ï¼Œç¢ºèªé©…å‹•æ•¸é‡ > 0

**å›å‚³å€¼ï¼š** Trueï¼ˆé©—è­‰é€šéï¼‰æˆ– Falseï¼ˆé©—è­‰å¤±æ•—ï¼‰

**ç‹€æ…‹æ›´æ–°ï¼š** é©—è­‰æˆåŠŸæ™‚æ›´æ–°ç‚º `Completed`ï¼Œå¤±æ•—æ™‚æ›´æ–°ç‚º `Failed_Validation`

---

### 5. Core Modules (`core/`)

#### WIM Operations (`wim_operations.py`)

**WIMOperations é¡åˆ¥æä¾›çš„ WIM æ˜ åƒæª”æ“ä½œæ–¹æ³•ï¼š**

- **`mount()`** - æ›è¼‰ WIM æ˜ åƒæª”åˆ°æŒ‡å®šç›®éŒ„ï¼Œä½¿ç”¨ DISM /Mount-Image å‘½ä»¤
- **`unmount()`** - å¸è¼‰ WIM æ˜ åƒæª”ï¼Œå¯é¸æ“‡æäº¤ï¼ˆ/Commitï¼‰æˆ–æ”¾æ£„ï¼ˆ/Discardï¼‰è®Šæ›´
- **`get_info()`** - å–å¾— WIM æ˜ åƒæª”è³‡è¨Šï¼Œä½¿ç”¨ DISM /Get-ImageInfo ä¸¦è§£æè¼¸å‡º
- **`add_driver()`** - æ³¨å…¥é©…å‹•ç¨‹å¼ï¼Œä½¿ç”¨ DISM /Add-Driver éè¿´å®‰è£
- **`add_package()`** - å®‰è£å¥—ä»¶ï¼ˆæ›´æ–°æª”/èªè¨€åŒ…ï¼‰ï¼Œä½¿ç”¨ DISM /Add-Package
- **`cleanup()`** - æ¸…ç†èˆ‡æœ€ä½³åŒ–æ˜ åƒæª”ï¼Œä½¿ç”¨ DISM /Cleanup-Image

#### DISM Wrapper (`dism_wrapper.py`)

**DismWrapper æ¨¡çµ„åŠŸèƒ½ï¼š**

- å°è£æ‰€æœ‰ DISM æ“ä½œä¸¦æä¾›çµ±ä¸€çš„éŒ¯èª¤è™•ç†
- æ”¯æ´é€¾æ™‚æ§åˆ¶ï¼ˆé è¨­ 1 å°æ™‚ï¼‰é˜²æ­¢æ“ä½œç„¡é™æœŸç­‰å¾…
- WIM ç´¢å¼•é©—è­‰ï¼ˆå¿…é ˆåœ¨ 1-100 ä¹‹é–“ï¼‰
- è‡ªå‹•è§£æ DISM å‘½ä»¤è¼¸å‡ºä¸¦è¿”å›çµæ§‹åŒ–çµæœ

---

## è³‡æ–™æµç¨‹

### å®Œæ•´å»ºç½®æµç¨‹åœ–

```
[ä½¿ç”¨è€…]
   â”‚
   â”‚ 1. POST /api/jobs
   â”‚    - motherboard: "X13SAV-LVDS"
   â”‚    - base_image: "Win11_23H2_x64"
   â–¼
[API Server]
   â”‚
   â”‚ 2. ä¸»æ©Ÿæ¿å‹è™ŸåŒ¹é…
   â”‚    find_similar_motherboards("X13SAV-LVDS")
   â”‚    â†’ æ‰¾åˆ° "X13SAV" (95% ç›¸ä¼¼)
   â”‚    â†’ å›å‚³å»ºè­°çµ¦ä½¿ç”¨è€…
   â”‚
   â”‚ 3. ä½¿ç”¨è€…ç¢ºèªé¸æ“‡ "X13SAV"
   â”‚
   â”‚ 4. CREATE BuildJob
   â”‚    - job_id: 1
   â”‚    - status: 'Queued'
   â”‚    - motherboard_model_name: "X13SAV"
   â–¼
[Database]
   â”‚
   â”‚ build_jobs table:
   â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â”‚ id  â”‚ status   â”‚ motherboard    â”‚ ...    â”‚
   â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ â”‚ 1   â”‚ Queued   â”‚ X13SAV         â”‚ ...    â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”‚ â—„â”€â”€â”€â”€â”€ æ¯ 5 ç§’è¼ªè©¢ â”€â”€â”€â”€â”€â”€
   â”‚                          â”‚
   â–¼                          â”‚
[Build Processor]            â”‚
   â”‚                          â”‚
   â”‚ 5. SELECT job WHERE status='Queued'  â”€â”€â”€â”€â”˜
   â”‚    â†’ å–å¾— job_id=1
   â”‚
   â”‚ 6. UPDATE status='Processing_Build'
   â”‚
   â”‚ 7. åŸ·è¡Œå»ºç½®æµç¨‹
   â”‚    â”œâ”€ è¤‡è£½åŸºç¤æ˜ åƒæª”
   â”‚    â”‚   0_BaseImages/Win11_23H2_x64/install.wim
   â”‚    â”‚   â†’ output/1_20250311120000/install.wim
   â”‚    â”‚
   â”‚    â”œâ”€ æ›è¼‰ WIM
   â”‚    â”‚   DISM /Mount-Image ... /MountDir:mnt
   â”‚    â”‚
   â”‚    â”œâ”€ æ³¨å…¥é©…å‹•
   â”‚    â”‚   2_Drivers/X13SAV/driver/ â†’ mnt/
   â”‚    â”‚
   â”‚    â”œâ”€ å¥—ç”¨æ›´æ–°
   â”‚    â”‚   4_Updates/KB5034441.msu â†’ mnt/
   â”‚    â”‚
   â”‚    â”œâ”€ å®‰è£èªè¨€åŒ…ï¼ˆè‹¥æœ‰ï¼‰
   â”‚    â”‚   3_LangPacks/ja-jp/ â†’ mnt/
   â”‚    â”‚
   â”‚    â”œâ”€ å¯«å…¥ç”¢å“é‡‘é‘°ï¼ˆè‹¥æœ‰ï¼‰
   â”‚    â”‚   DISM /Set-ProductKey:...
   â”‚    â”‚
   â”‚    â”œâ”€ æ¸…ç†æœ€ä½³åŒ–
   â”‚    â”‚   DISM /Cleanup-Image ...
   â”‚    â”‚
   â”‚    â””â”€ å¸è¼‰å„²å­˜
   â”‚        DISM /Unmount-Image /Commit
   â”‚
   â”‚ 8. ç”Ÿæˆ Manifest
   â”‚    output/1_20250311120000/manifest.json
   â”‚
   â”‚ 9. UPDATE status='Pending_Validation'
   â”‚       output_image_path='output/1_20250311120000/install.wim'
   â”‚       manifest_path='output/1_20250311120000/manifest.json'
   â”‚
   â–¼
[Database]
   â”‚
   â”‚ build_jobs table:
   â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â”‚ id  â”‚ status             â”‚ output_path    â”‚
   â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ â”‚ 1   â”‚ Pending_Validation â”‚ output/1_.../  â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”‚ â—„â”€â”€â”€â”€â”€ æ¯ 10 ç§’è¼ªè©¢ â”€â”€â”€â”€â”€â”€
   â”‚                           â”‚
   â–¼                           â”‚
[Validation Processor]        â”‚
   â”‚                           â”‚
   â”‚ 10. SELECT job WHERE status='Pending_Validation'  â”€â”€â”€â”€â”˜
   â”‚     â†’ å–å¾— job_id=1
   â”‚
   â”‚ 11. UPDATE status='Processing_Validation'
   â”‚
   â”‚ 12. åŸ·è¡Œé©—è­‰æµç¨‹
   â”‚     â”œâ”€ æª¢æŸ¥æª”æ¡ˆå­˜åœ¨
   â”‚     â”œâ”€ é©—è­‰å®Œæ•´æ€§ï¼ˆMD5ï¼‰
   â”‚     â”œâ”€ æª¢æŸ¥æ˜ åƒæª”çµæ§‹
   â”‚     â”œâ”€ é©—è­‰ Manifest
   â”‚     â””â”€ ç¢ºèªå…ƒä»¶å®‰è£
   â”‚
   â”‚ 13. é©—è­‰çµæœ
   â”‚     â”œâ”€ æˆåŠŸ â†’ UPDATE status='Verified'
   â”‚     â””â”€ å¤±æ•— â†’ UPDATE status='Failed_Validation'
   â”‚
   â–¼
[Database]
   â”‚
   â”‚ build_jobs table:
   â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â”‚ id  â”‚ status   â”‚ output_path  â”‚ completed_at â”‚
   â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ â”‚ 1   â”‚ Verified â”‚ output/1_... â”‚ 2025-03-11   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”‚ â—„â”€â”€â”€â”€â”€ æ¯ 5 ç§’è¼ªè©¢ â”€â”€â”€â”€â”€â”€
   â”‚                          â”‚
   â–¼                          â”‚
[Web UI]                     â”‚
   â”‚                          â”‚
   â”‚ 14. GET /api/jobs  â”€â”€â”€â”€â”€â”€â”˜
   â”‚     â†’ å–å¾—æœ€æ–°ç‹€æ…‹
   â”‚
   â”‚ 15. é¡¯ç¤ºçµ¦ä½¿ç”¨è€…
   â”‚     âœ… Job #1: Verified
   â”‚        Output: output/1_20250311120000/install.wim
   â”‚
   â””â”€â”€â”€â”€> [ä½¿ç”¨è€…çœ‹åˆ°å®Œæˆé€šçŸ¥]
```

---

## Web UI æ¶æ§‹

### å‰ç«¯æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä½¿ç”¨è€…ç€è¦½å™¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚           React Application                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚  App.tsx (æ ¹å…ƒä»¶)                      â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â”œâ”€ React Router (è·¯ç”±ç®¡ç†)            â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â””â”€ TanStack Query Provider (ç‹€æ…‹ç®¡ç†) â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â”‚                                               â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚  Pages (é é¢å±¤)                        â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â””â”€ Jobs.tsx                           â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     â”œâ”€ useQuery (å–å¾— jobs)            â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     â”œâ”€ refetchInterval: 5000ms         â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     â””â”€ æ¸²æŸ“ Card å…ƒä»¶                   â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â”‚                                               â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚  Components (å…ƒä»¶å±¤)                   â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â””â”€ ui/                                â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     â”œâ”€ Card.tsx                        â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     â”œâ”€ Button.tsx                      â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     â””â”€ Badge.tsx                       â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â”‚                                               â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚  API Layer (lib/api.ts)                â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â”œâ”€ getJobs()                          â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â”œâ”€ getJob(id)                         â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â”œâ”€ createJob(data)                    â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  â””â”€ retryJob(id)                       â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â”‚                    â”‚                          â”‚      â”‚
â”‚  â”‚                    â”‚ HTTP/JSON                â”‚      â”‚
â”‚  â”‚                    â–¼                          â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚  Fetch API                             â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  GET /api/jobs                         â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  POST /api/jobs                        â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  ...                                   â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP (port 5000)
                          â–¼
                 [Flask API Server]
```

### æ ¸å¿ƒå…ƒä»¶èªªæ˜

#### 1. API å®¢æˆ¶ç«¯ (`lib/api.ts`)

è² è²¬çµ±ä¸€çš„ API è«‹æ±‚è™•ç†ï¼ŒåŒ…å«ï¼š

- æ¨™æº–åŒ–çš„ HTTP è«‹æ±‚å°è£
- éŒ¯èª¤è™•ç†èˆ‡å›æ‡‰è§£æ
- å°å¤–æš´éœ²çš„ API æ–¹æ³•ï¼ˆgetJobsã€getJobã€createJobã€retryJob ç­‰ï¼‰

#### 2. Jobs åˆ—è¡¨é é¢ (`pages/Jobs.tsx`)

æä¾›ä»»å‹™ç®¡ç†ä»‹é¢ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š

- ä½¿ç”¨ TanStack Query è‡ªå‹•ç®¡ç†è³‡æ–™å¿«å–èˆ‡é‡æ–°å–å¾—
- ä»»å‹™ç‹€æ…‹è¦–è¦ºåŒ–é¡¯ç¤ºï¼ˆé¡è‰²ç·¨ç¢¼ï¼‰
- ä»»å‹™åˆ—è¡¨å±•ç¤ºèˆ‡æ“ä½œæŒ‰éˆ•
- è‡ªå‹•å®šæœŸåˆ·æ–°ï¼ˆæ¯ 5 ç§’ï¼‰

#### 3. TypeScript é¡å‹å®šç¾© (`types/api.ts`)

**JobStatus é¡å‹å®šç¾©ï¼š**

- æ”¯æ´ 7 ç¨®ä»»å‹™ç‹€æ…‹ï¼š'Queued'ï¼ˆå·²æ’éšŠï¼‰ã€'Processing_Build'ï¼ˆå»ºç½®ä¸­ï¼‰ã€'Pending_Validation'ï¼ˆå¾…é©—è­‰ï¼‰ã€'Processing_Validation'ï¼ˆé©—è­‰ä¸­ï¼‰ã€'Verified'ï¼ˆå·²é©—è­‰ï¼‰ã€'Failed_Build'ï¼ˆå»ºç½®å¤±æ•—ï¼‰ã€'Failed_Validation'ï¼ˆé©—è­‰å¤±æ•—ï¼‰

**BuildJob ä»‹é¢å®šç¾©ï¼š**

- ä»»å‹™åŸºæœ¬è³‡è¨Šï¼šjob_idï¼ˆä»»å‹™ IDï¼‰ã€motherboard_model_nameï¼ˆä¸»æ©Ÿæ¿å‹è™Ÿï¼‰ã€base_image_nameï¼ˆåŸºç¤æ˜ åƒåç¨±ï¼‰ã€customer_nameï¼ˆå®¢æˆ¶åç¨±ï¼‰ã€statusï¼ˆä»»å‹™ç‹€æ…‹ï¼‰
- å¯é¸æ¬„ä½ï¼šproduct_keyï¼ˆç”¢å“é‡‘é‘°ï¼‰ã€log_messageï¼ˆæ—¥èªŒè¨Šæ¯ï¼‰ã€output_image_pathï¼ˆè¼¸å‡ºæ˜ åƒè·¯å¾‘ï¼‰ã€manifest_pathï¼ˆmanifest æª”æ¡ˆè·¯å¾‘ï¼‰ã€started_atï¼ˆé–‹å§‹æ™‚é–“ï¼‰ã€completed_atï¼ˆå®Œæˆæ™‚é–“ï¼‰
- å¿…éœ€æ¬„ä½ï¼šretry_countï¼ˆé‡è©¦æ¬¡æ•¸ï¼‰ã€created_atï¼ˆå»ºç«‹æ™‚é–“ï¼‰ã€updated_atï¼ˆæ›´æ–°æ™‚é–“ï¼‰ã€componentsï¼ˆå…ƒä»¶æ¸…å–®ï¼‰

**JobComponent ä»‹é¢å®šç¾©ï¼š**

- å…ƒä»¶ IDï¼ˆcomponent_idï¼‰ã€å…ƒä»¶é¡å‹ï¼ˆcomponent_typeï¼šDriverã€Updateã€LangPackã€Softwareï¼‰ã€å…ƒä»¶ä¾†æºè·¯å¾‘ï¼ˆsource_pathï¼‰

**CreateJobPayload ä»‹é¢å®šç¾©ï¼š**

- å¿…éœ€æ¬„ä½ï¼šmotherboard_modelï¼ˆä¸»æ©Ÿæ¿å‹è™Ÿï¼‰ã€base_imageï¼ˆåŸºç¤æ˜ åƒï¼‰
- å¯é¸æ¬„ä½ï¼šcustomer_nameï¼ˆå®¢æˆ¶åç¨±ï¼‰ã€product_keyï¼ˆç”¢å“é‡‘é‘°ï¼‰ã€selected_existing_modelï¼ˆé¸å®šçš„ç¾æœ‰ä¸»æ©Ÿæ¿å‹è™Ÿï¼‰ã€confirm_new_modelï¼ˆç¢ºèªæ–°ä¸»æ©Ÿæ¿å‹è™Ÿï¼‰ã€componentsï¼ˆå…ƒä»¶é™£åˆ—ï¼ŒåŒ…å«é¡å‹èˆ‡è·¯å¾‘ï¼‰

### å»ºç½®èˆ‡éƒ¨ç½²æµç¨‹

#### é–‹ç™¼æ¨¡å¼

**é–‹ç™¼ä¼ºæœå™¨å•Ÿå‹•æ–¹å¼ï¼š**

- çµ‚ç«¯ 1ï¼šåŸ·è¡Œ `python api/server.py` å•Ÿå‹• Flask APIï¼Œé‹è¡Œæ–¼ <http://localhost:5000>
- çµ‚ç«¯ 2ï¼šé€²å…¥ web ç›®éŒ„åŸ·è¡Œ `npm run dev` å•Ÿå‹• Vite é–‹ç™¼ä¼ºæœå™¨ï¼Œé‹è¡Œæ–¼ <http://localhost:5173ï¼Œè‡ªå‹•ä»£ç†> /api/* è«‹æ±‚åˆ° localhost:5000

**Vite é–‹ç™¼ä¼ºæœå™¨ç‰¹æ€§ï¼š**

- HMRï¼ˆç†±æ¨¡çµ„æ›¿æ›ï¼‰æä¾›æ¥µå¿«é‡è¼‰é€Ÿåº¦
- è‡ªå‹•é‡æ–°è¼‰å…¥åŠŸèƒ½
- API ä»£ç†è¨­å®šè‡ªå‹•è½‰ç™¼ API è«‹æ±‚åˆ°å¾Œç«¯æœå‹™

**Vite è¨­å®šå…§å®¹ï¼š**

- åœ¨ vite.config.ts ä¸­é…ç½® /api è·¯ç”±ä»£ç†
- target æŒ‡å‘ <http://localhost:5000ï¼ˆFlask> å¾Œç«¯ä½å€ï¼‰
- changeOrigin è¨­ç‚º true ç¢ºä¿è·¨åŸŸæ­£ç¢ºè™•ç†

#### ç”Ÿç”¢æ¨¡å¼

**ç”Ÿç”¢éƒ¨ç½²æ­¥é©Ÿï¼š**

1. å»ºç½®å‰ç«¯ï¼šé€²å…¥ web ç›®éŒ„åŸ·è¡Œ `npm run build` ç”Ÿæˆéœæ…‹æª”æ¡ˆåˆ° web/dist/
2. è¤‡è£½éœæ…‹æª”æ¡ˆï¼šä½¿ç”¨ xcopyï¼ˆWindowsï¼‰æˆ– cp å‘½ä»¤å°‡ dist/ å…§å®¹è¤‡è£½åˆ° Flask çš„ static/ ç›®éŒ„
3. å•Ÿå‹• Flaskï¼šåŸ·è¡Œ `python api/server.py`ï¼ŒåŒæ™‚æœå‹™ Web UIï¼ˆ<http://localhost:5000ï¼‰èˆ‡> APIï¼ˆ<http://localhost:5000/api/*ï¼‰>

**ä¸€éµéƒ¨ç½²è…³æœ¬åŠŸèƒ½ï¼š**

- deploy_web.bat è‡ªå‹•åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š
  - é€²å…¥ web ç›®éŒ„
  - åŸ·è¡Œ npm install å®‰è£ä¾è³´
  - åŸ·è¡Œ npm run build å»ºç½®ç”Ÿç”¢ç‰ˆæœ¬
  - è¿”å›ä¸Šå±¤ç›®éŒ„
  - è¤‡è£½ dist/ æª”æ¡ˆåˆ° static/ ç›®éŒ„
  - è¼¸å‡ºå®Œæˆè¨Šæ¯

---

## éƒ¨ç½²æŒ‡å—

### ç³»çµ±éœ€æ±‚

**ç¡¬é«”ï¼š**

- CPU: 4 æ ¸å¿ƒä»¥ä¸Š
- RAM: 8GB ä»¥ä¸Š
- å„²å­˜ç©ºé–“: 100GB ä»¥ä¸Šï¼ˆä¾æ˜ åƒæª”æ•¸é‡èª¿æ•´ï¼‰

**è»Ÿé«”ï¼š**

- Windows 10/11 æˆ– Windows Server 2019/2022
- Python 3.8+
- Node.js 18+ (åƒ…å»ºç½®æ™‚éœ€è¦)
- DISM å·¥å…·ï¼ˆWindows å…§å»ºï¼‰

### åˆæ¬¡éƒ¨ç½²æ­¥é©Ÿ

#### 1. å®‰è£ Python ä¾è³´

**Python ä¾è³´å®‰è£æ–¹å¼ï¼š**

- æ–¹æ³• 1ï¼šä½¿ç”¨ pip åŸ·è¡Œ `pip install -r requirements.txt` å®‰è£æ‰€æœ‰ä¾è³´
- æ–¹æ³• 2ï¼šä½¿ç”¨ uvï¼ˆæ¨è–¦ï¼Œæ›´å¿«ï¼‰åŸ·è¡Œ `uv sync` é€²è¡Œä¾è³´åŒæ­¥

#### 2. åˆå§‹åŒ–è³‡æ–™åº«

**è³‡æ–™åº«åˆå§‹åŒ–æµç¨‹ï¼š**

- åŸ·è¡Œ `python init_db.py` åˆå§‹åŒ–è³‡æ–™åº«
- ç¨‹å¼æœƒè‡ªå‹•å»ºç«‹å¿…è¦çš„è³‡æ–™è¡¨çµæ§‹
- æˆåŠŸå®Œæˆå¾Œè¼¸å‡ºæç¤ºè¨Šæ¯ï¼Œé¡¯ç¤ºè³‡æ–™åº«ä½ç½®ï¼ˆé€šå¸¸ç‚º C:\Users\...\wait.dbï¼‰

#### 3. æº–å‚™ç›®éŒ„çµæ§‹

**å»ºç«‹å¿…è¦ç›®éŒ„çµæ§‹ï¼š**

- åŸ·è¡Œ mkdir å‘½ä»¤å»ºç«‹ä»¥ä¸‹ç›®éŒ„ï¼š0_BaseImagesã€2_Driversã€3_LangPacksã€4_Updatesã€output

**åŸºç¤æ˜ åƒæª”é…ç½®ï¼š**

- å°‡ Windows WIM æª”æ¡ˆæ”¾ç½®æ–¼ 0_BaseImages/ ç›®éŒ„ä¸‹
- æ¯å€‹æ˜ åƒå»ºç«‹å­ç›®éŒ„ï¼ˆå¦‚ Win10_22H2_x64ã€Win11_23H2_x64ï¼‰ï¼Œå…§å« install.wim æª”æ¡ˆ

**é©…å‹•ç¨‹å¼é…ç½®ï¼š**

- åœ¨ 2_Drivers/ ç›®éŒ„ä¸‹æŒ‰ä¸»æ©Ÿæ¿å‹è™Ÿå»ºç«‹å­ç›®éŒ„ï¼ˆå¦‚ X13SAVã€X12STH-SYSï¼‰
- æ¯å€‹ä¸»æ©Ÿæ¿ç›®éŒ„ä¸‹å»ºç«‹ driver/ å­ç›®éŒ„
- åœ¨ driver/ ç›®éŒ„ä¸‹çµ„ç¹”é©…å‹•æª”æ¡ˆï¼ˆå¦‚ chipsetã€network ç­‰åˆ†é¡ç›®éŒ„ï¼‰

#### 4. å»ºç½® Web UIï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰

**Web UI å»ºç½®æ–¹å¼ï¼š**

- æ–¹å¼ 1ï¼ˆæ¨è–¦ï¼‰ï¼šç›´æ¥åŸ·è¡Œ `deploy_web.bat` è…³æœ¬å®Œæˆè‡ªå‹•åŒ–éƒ¨ç½²
- æ–¹å¼ 2ï¼ˆæ‰‹å‹•ï¼‰ï¼šé€²å…¥ web ç›®éŒ„åŸ·è¡Œ `npm install` å®‰è£ä¾è³´ï¼ŒåŸ·è¡Œ `npm run build` å»ºç½®ç”Ÿç”¢ç‰ˆæœ¬ï¼Œè¿”å›ä¸Šå±¤ç›®éŒ„åŸ·è¡Œ xcopy è¤‡è£½æª”æ¡ˆåˆ° static/ ç›®éŒ„

#### 5. å•Ÿå‹•æœå‹™

**æœå‹™å•Ÿå‹•æ–¹å¼ï¼š**

- æ–¹æ³• 1ï¼ˆæ¨è–¦ï¼‰ï¼šåŸ·è¡Œ `start_all.bat`ï¼Œä¸€æ¬¡å•Ÿå‹• API ä¼ºæœå™¨ã€Build Processorï¼ˆå…§å«è‡ªå‹•é©—è­‰æµç¨‹ï¼‰ä¸¦è‡ªå‹•é–‹å•Ÿ Web UIã€‚
- æ–¹æ³• 2ï¼ˆåˆ†åˆ¥å•Ÿå‹•ï¼‰ï¼š
  - çµ‚ç«¯ 1ï¼šåŸ·è¡Œ `python workers/build_processor.py` â”€ å»ºç½®æµç¨‹å®Œæˆå¾Œæœƒè‡ªå‹•è§¸ç™¼é©—è­‰ã€‚
  - çµ‚ç«¯ 2ï¼šåŸ·è¡Œ `python api/server.py` â”€ å•Ÿå‹• Flask API / Web UIã€‚
  - çµ‚ç«¯ 3ï¼ˆé¸ç”¨ï¼‰ï¼šåŸ·è¡Œ `python workers/validation_processor.py` â”€ åƒ…åœ¨éœ€è¦ç¨ç«‹æ’ç¨‹æˆ–é‡è·‘æ­·å²é©—è­‰æ™‚å•Ÿå‹•ã€‚

> â„¹ï¸ è‹¥åƒ…åŸ·è¡Œ Build Processorï¼Œå³å¯å®Œæˆå»ºç½®èˆ‡é©—è­‰ï¼›ç¨ç«‹ Validation Processor å»ºè­°åªåœ¨éœ€è¦é•·æ™‚é–“é©—è­‰ä½‡åˆ—æˆ–é‡æ–°é©—è­‰æ—¢æœ‰è¼¸å‡ºæ™‚å•Ÿç”¨ã€‚

#### 6. é©—è­‰éƒ¨ç½²

**éƒ¨ç½²é©—è­‰æ­¥é©Ÿï¼š**

1. é–‹å•Ÿç€è¦½å™¨è¨ªå• <http://localhost:5000> æª¢æŸ¥ Web UI æ˜¯å¦æ­£å¸¸é¡¯ç¤º
2. è¨ªå• <http://localhost:5000/api/health> æª¢æŸ¥ API å¥åº·ç‹€æ…‹
3. é æœŸå›æ‡‰æ‡‰åŒ…å« success å­—æ®µç‚º trueã€status ç‚º healthyã€database ç‚º connectedã€version ç‚º 2.0ï¼Œè¡¨ç¤ºéƒ¨ç½²æˆåŠŸ

---

## é–‹ç™¼æŒ‡å—

### å°ˆæ¡ˆè¨­å®š

#### å¾Œç«¯é–‹ç™¼

**å¾Œç«¯é–‹ç™¼ç’°å¢ƒè¨­ç½®æµç¨‹ï¼š**

1. ä½¿ç”¨ `python -m venv .venv` å»ºç«‹è™›æ“¬ç’°å¢ƒ
2. å•Ÿå‹•è™›æ“¬ç’°å¢ƒï¼ˆWindows åŸ·è¡Œ `.venv\Scripts\activate`ï¼ŒLinux/Mac åŸ·è¡Œ `source .venv/bin/activate`ï¼‰
3. å®‰è£é–‹ç™¼ä¾è³´ï¼šåŸ·è¡Œ `pip install -r requirements.txt` å®‰è£åŸºç¤ä¾è³´ï¼Œå†åŸ·è¡Œ `pip install pytest pytest-cov black flake8` å®‰è£é–‹ç™¼å·¥å…·
4. åŸ·è¡Œæ¸¬è©¦ï¼šä½¿ç”¨ `pytest tests/ -v --cov=.` é‹è¡Œå–®å…ƒæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
5. ç¨‹å¼ç¢¼æ ¼å¼åŒ–ï¼šåŸ·è¡Œ `black .` è‡ªå‹•æ ¼å¼åŒ–ç¨‹å¼ç¢¼
6. ç¨‹å¼ç¢¼æª¢æŸ¥ï¼šåŸ·è¡Œ `flake8 .` æª¢æŸ¥ç¨‹å¼ç¢¼é¢¨æ ¼å’Œæ½›åœ¨å•é¡Œ

#### å‰ç«¯é–‹ç™¼

**å‰ç«¯é–‹ç™¼ç’°å¢ƒè¨­ç½®æµç¨‹ï¼š**

1. é€²å…¥ web ç›®éŒ„åŸ·è¡Œ `npm install` å®‰è£ä¾è³´
2. åŸ·è¡Œ `npm run dev` å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼Œé‹è¡Œæ–¼ <http://localhost:5173ï¼Œæ”¯æ´> HMR ç†±é‡è¼‰
3. åŸ·è¡Œ `npm run type-check` é€²è¡Œ TypeScript é¡å‹æª¢æŸ¥
4. åŸ·è¡Œ `npm run lint` é€²è¡Œç¨‹å¼ç¢¼é¢¨æ ¼æª¢æŸ¥
5. åŸ·è¡Œ `npm run build` å»ºç½®ç”Ÿç”¢å„ªåŒ–ç‰ˆæœ¬
6. åŸ·è¡Œ `npm run preview` æœ¬åœ°é è¦½ç”Ÿç”¢ç‰ˆæœ¬æ•ˆæœ

---

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. è³‡æ–™åº«é–å®šéŒ¯èª¤

**å•é¡Œï¼š** SQLite å ±å‘Š `database is locked` éŒ¯èª¤

**åŸå› ï¼š** å¤šå€‹è™•ç†å™¨ï¼ˆBuild Processorã€Validation Processorï¼‰åŒæ™‚å¯«å…¥ SQLite è³‡æ–™åº«ï¼Œå°è‡´é–å®šè¡çª

**è§£æ±ºæ–¹æ¡ˆï¼š**

- åœ¨ config.py ä¸­å¢åŠ  DATABASE_TIMEOUT è¨­å®šç‚º 30 ç§’
- åœ¨ database/manager.py ä¸­ä¿®æ”¹ SQLAlchemy engine å‰µå»ºï¼š
  - ä½¿ç”¨ StaticPool ä½œç‚ºé€£ç·šæ± é¡åˆ¥
  - åœ¨ connect_args ä¸­è¨­å®š timeout åƒæ•¸ç‚º DATABASE_TIMEOUT å€¼
  - è¨­å®š check_same_thread ç‚º False å…è¨±å¤šç·šç¨‹å­˜å–
  - æ­¤é…ç½®å¯å¤§å¹…é™ä½è³‡æ–™åº«é–å®šç™¼ç”Ÿé »ç‡

#### 2. DISM æ›è¼‰å¤±æ•—

**å•é¡Œï¼š** DISM å‘½ä»¤è¿”å› `Error: 87 - The parameter is incorrect`

**å¯èƒ½åŸå› ï¼š**

- WIM æª”æ¡ˆå·²ç¶“è¢«æ›è¼‰åˆ°å…¶ä»–ä½ç½®ï¼ˆç„¡æ³•é‡è¤‡æ›è¼‰ï¼‰
- æ›è¼‰ç›®éŒ„è·¯å¾‘ä¸å­˜åœ¨æˆ–è·¯å¾‘ä¸æ­£ç¢º
- åŸ·è¡Œæ¬Šé™ä¸è¶³ï¼Œæœªä»¥ç³»çµ±ç®¡ç†å“¡èº«ä»½é‹è¡Œ

**è§£æ±ºæ–¹æ¡ˆæ­¥é©Ÿï¼š**

1. åŸ·è¡Œ `DISM /Get-MountedImageInfo` æª¢æŸ¥ç³»çµ±ä¸­æ˜¯å¦æœ‰å·²æ›è¼‰çš„æ˜ åƒ
2. è‹¥æœ‰æ›è¼‰ä¸­çš„æ˜ åƒï¼ŒåŸ·è¡Œ `DISM /Unmount-Image /MountDir:mnt /Discard` å¼·åˆ¶å¸è¼‰ï¼Œå†åŸ·è¡Œ `DISM /Cleanup-Wim` æ¸…ç†æ›è¼‰è³‡è¨Š
3. ç¢ºèªæ›è¼‰ç›®éŒ„å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åŸ·è¡Œ `mkdir mnt` å»ºç«‹ç›®éŒ„
4. ä½¿ç”¨ç³»çµ±ç®¡ç†å“¡èº«ä»½å•Ÿå‹•å‘½ä»¤åˆ—è¦–çª—ï¼ˆå³éµ â†’ ä»¥ç³»çµ±ç®¡ç†å“¡èº«ä»½åŸ·è¡Œï¼‰é‡æ–°åŸ·è¡Œ DISM å‘½ä»¤

#### 3. Web UI é¡¯ç¤ºç©ºç™½

**å•é¡Œï¼š** ç€è¦½å™¨è¨ªå• <http://localhost:5000> æ™‚åªçœ‹åˆ°ç©ºç™½é é¢ï¼Œæœªèƒ½æ­£ç¢ºé¡¯ç¤º React ä»‹é¢

**è¨ºæ–·æ­¥é©Ÿï¼š**

1. æª¢æŸ¥ static/ ç›®éŒ„æ˜¯å¦å­˜åœ¨ï¼šWindows åŸ·è¡Œ `dir static\`ï¼ŒLinux/Mac åŸ·è¡Œ `ls static/`
2. æª¢æŸ¥ index.html æ˜¯å¦å­˜åœ¨æ–¼ static/ ç›®éŒ„ä¸­ï¼šåŸ·è¡Œ `dir static\index.html`ï¼ˆWindowsï¼‰
3. é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆæŒ‰ F12ï¼‰æª¢æŸ¥ï¼š
   - æŸ¥çœ‹ Console æ¨™ç±¤æ˜¯å¦æœ‰ JavaScript éŒ¯èª¤è¨Šæ¯
   - æŸ¥çœ‹ Network æ¨™ç±¤æ˜¯å¦æœ‰ 404 Not Found éŒ¯èª¤ï¼ˆç‰¹åˆ¥æ˜¯ index.htmlã€bundle.js ç­‰æª”æ¡ˆï¼‰
4. è‹¥ç¢ºèªæª”æ¡ˆç¼ºå¤±ï¼Œé‡æ–°å»ºç½®å‰ç«¯ï¼šé€²å…¥ web ç›®éŒ„åŸ·è¡Œ `npm run build`ï¼Œç„¶å¾Œè¤‡è£½ dist/ å…§å®¹åˆ° static/ ç›®éŒ„ï¼ˆåŸ·è¡Œ `xcopy /E /I /Y web\dist\* static\`ï¼‰

#### 4. API é€£ç·šå¤±æ•—

**å•é¡Œï¼š** å‰ç«¯ç™¼é€ API è«‹æ±‚æ™‚å¤±æ•—ï¼Œå°è‡´ç„¡æ³•è¼‰å…¥è³‡æ–™

**æª¢æŸ¥æ¸…å–®ï¼š**

1. ç¢ºèª Flask ä¼ºæœå™¨æ­£åœ¨åŸ·è¡Œï¼šåŸ·è¡Œ `netstat -an | findstr :5000` æª¢æŸ¥åŸ  5000 æ˜¯å¦é–‹æ”¾
2. æ¸¬è©¦ API å¥åº·ç‹€æ…‹ï¼šåŸ·è¡Œ `curl http://localhost:5000/api/health` ç›´æ¥æ¸¬è©¦ API ç«¯é»æ˜¯å¦éŸ¿æ‡‰
3. æª¢æŸ¥ Windows é˜²ç«ç‰†è¨­å®šï¼šé–‹å•Ÿ Windows Defender Firewallï¼Œåœ¨ã€Œå…è¨±æ‡‰ç”¨ç¨‹å¼ã€ä¸­ç¢ºèª Python å·²è¢«è¨±å¯
4. æª¢æŸ¥ CORS è¨­å®šï¼šç¢ºèª api/server.py ä¸­å·²åŸ·è¡Œ `CORS(app)` å•Ÿç”¨ CORS æ”¯æ´ï¼Œå…è¨±è·¨åŸŸè«‹æ±‚

#### 5. å»ºç½®å¡ä½ä¸å‹•

**å•é¡Œï¼š** Job ä»»å‹™ç‹€æ…‹åœç•™åœ¨ `Processing_Build` ç‹€æ…‹å¾ˆé•·æ™‚é–“ï¼Œç„¡æ³•é€²å±•åˆ°é©—è­‰éšæ®µ

**è¨ºæ–·æ­¥é©Ÿï¼š**

1. æª¢æŸ¥ Build Processor æ—¥èªŒï¼šæŸ¥çœ‹é‹è¡Œ Build Processor çš„å‘½ä»¤åˆ—è¦–çª—è¼¸å‡ºï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯æˆ–å¡ä½çš„æ­¥é©Ÿ
2. æª¢æŸ¥ DISM æ˜¯å¦åœ¨åŸ·è¡Œï¼šä½¿ç”¨ `tasklist | findstr DISM` æª¢æŸ¥ DISM ç¨‹åºæ˜¯å¦ä»åœ¨åŸ·è¡Œï¼ˆå¯èƒ½è¡¨ç¤ºæ›è¼‰æˆ–æ“ä½œæœªå®Œæˆï¼‰
3. æª¢æŸ¥æ›è¼‰ç‹€æ…‹ï¼šåŸ·è¡Œ `DISM /Get-MountedImageInfo` æŸ¥çœ‹æ˜¯å¦æœ‰æœªå¸è¼‰çš„æ˜ åƒ
4. æ‰‹å‹•å¸è¼‰ï¼ˆå¦‚æœç¢ºèªå¡ä½ï¼‰ï¼šåŸ·è¡Œ `DISM /Unmount-Image /MountDir:mnt /Discard` å¼·åˆ¶å¸è¼‰ï¼Œå†åŸ·è¡Œ `DISM /Cleanup-Wim` æ¸…ç†
5. é‡æ–°å•Ÿå‹• Build Processorï¼šé—œé–‰å‘½ä»¤åˆ—è¦–çª—ï¼Œå†æ¬¡åŸ·è¡Œ Build Processor é‡æ–°é–‹å§‹å»ºç½®æµç¨‹

---

## é™„éŒ„

### A. è¨­å®šæª”èªªæ˜

**config.py ä¸­çš„ Config é¡åˆ¥åŒ…å«ä»¥ä¸‹è¨­å®šé …ç›®ï¼š**

**è³‡æ–™åº«è¨­å®šï¼š**

- DATABASE_PATHï¼šæŒ‡å®š SQLite è³‡æ–™åº«æª”æ¡ˆä½ç½®ï¼Œé è¨­ç‚º "wait.db"

**ç›®éŒ„è·¯å¾‘è¨­å®šï¼š**

- BASE_IMAGES_DIRï¼šåŸºç¤æ˜ åƒæª”ç›®éŒ„ï¼ˆ0_BaseImagesï¼‰
- DRIVERS_DIRï¼šé©…å‹•ç¨‹å¼ç›®éŒ„ï¼ˆ2_Driversï¼‰
- LANG_PACKS_DIRï¼šèªè¨€åŒ…ç›®éŒ„ï¼ˆ3_LangPacksï¼‰
- UPDATES_DIRï¼šWindows æ›´æ–°æª”ç›®éŒ„ï¼ˆ4_Updatesï¼‰
- OUTPUT_DIRï¼šè¼¸å‡ºç›®éŒ„ï¼ˆoutputï¼‰

**API è¨­å®šï¼š**

- API_HOSTï¼šAPI æœå‹™ç›£è½ä½å€ï¼Œ"0.0.0.0" è¡¨ç¤ºç›£è½æ‰€æœ‰ç¶²è·¯ä»‹é¢
- API_PORTï¼šAPI æœå‹™åŸ è™Ÿï¼ˆé è¨­ 5000ï¼‰
- API_DEBUGï¼šé™¤éŒ¯æ¨¡å¼é–‹é—œï¼Œç”Ÿç”¢ç’°å¢ƒæ‡‰è¨­ç‚º False

**å»ºç½®è¨­å®šï¼š**

- BUILD_TIMEOUTï¼šå»ºç½®è¶…æ™‚æ™‚é–“ï¼ˆ2 å°æ™‚ = 7200 ç§’ï¼‰
- BUILD_MAX_RETRIESï¼šæœ€å¤§é‡è©¦æ¬¡æ•¸ï¼ˆé è¨­ 3 æ¬¡ï¼‰

**é©—è­‰è¨­å®šï¼š**

- VALIDATION_TIMEOUTï¼šé©—è­‰è¶…æ™‚æ™‚é–“ï¼ˆ5 åˆ†é˜ = 300 ç§’ï¼‰

**Worker è¼ªè©¢é–“éš”ï¼š**

- BUILD_POLL_INTERVALï¼šBuild Processor è¼ªè©¢é–“éš”ï¼ˆ5 ç§’ï¼‰
- VALIDATION_POLL_INTERVALï¼šValidation Processor è¼ªè©¢é–“éš”ï¼ˆ10 ç§’ï¼‰

### B. è³‡æ–™åº« Schema - Version 2.0

**Version 2.0 Schema** - 4è¡¨è¨­è¨ˆï¼Œæ”¯æ´ä½¿ç”¨è€…ç®¡ç†èˆ‡è©³ç´°æ—¥èªŒ

**users è¡¨æ ¼ï¼ˆä½¿ç”¨è€…å¸³è™Ÿè¡¨ï¼‰çµæ§‹ï¼š**

- ä¸»éµï¼šuser_idï¼ˆè‡ªå‹•éå¢ï¼‰
- åŸºæœ¬æ¬„ä½ï¼šusernameï¼ˆä½¿ç”¨è€…åç¨±ï¼Œå”¯ä¸€ï¼‰ã€password_hashï¼ˆå¯†ç¢¼é›œæ¹Šï¼‰ã€created_atã€updated_at
- é—œè¯ï¼šèˆ‡ build_jobs å’Œ webhooks è¡¨å»ºç«‹é—œè¯ï¼Œè¿½è¹¤å»ºç«‹è€…

**build_jobs è¡¨æ ¼ï¼ˆå»ºç½®ä»»å‹™ä¸»è¡¨ï¼‰çµæ§‹ï¼š**

- ä¸»éµï¼šjob_idï¼ˆè‡ªå‹•éå¢ï¼‰
- åŸºæœ¬æ¬„ä½ï¼šmotherboard_model_nameï¼ˆä¸»æ©Ÿæ¿å‹è™Ÿï¼‰ã€base_image_nameï¼ˆåŸºç¤æ˜ åƒåç¨±ï¼‰ã€customer_nameï¼ˆå®¢æˆ¶åç¨±ï¼Œé è¨­ 'Default'ï¼‰ã€statusï¼ˆä»»å‹™ç‹€æ…‹ï¼‰ã€product_keyï¼ˆç”¢å“é‡‘é‘°ï¼‰ã€current_stepï¼ˆç›®å‰æ­¥é©Ÿï¼‰ã€retry_countï¼ˆé‡è©¦æ¬¡æ•¸ï¼Œé è¨­ 0ï¼‰ã€log_messageï¼ˆæ—¥èªŒè¨Šæ¯ï¼‰
- è³‡æºè·¯å¾‘æ¬„ä½ï¼ˆç”¨æ–¼å¯é‡ç¾æ€§ï¼‰ï¼šdriver_pathã€langpack_pathã€updates_pathã€software_pathã€base_image_path
- è¼¸å‡ºè·¯å¾‘æ¬„ä½ï¼šoutput_image_pathã€manifest_pathã€checksum_path
- æ™‚é–“æˆ³è¨˜æ¬„ä½ï¼šcreated_atã€updated_atã€started_atã€completed_at

**job_logs è¡¨æ ¼ï¼ˆä»»å‹™æ—¥èªŒè¡¨ï¼‰çµæ§‹ï¼š**

- è¤‡åˆä¸»éµï¼š(job_id, timestamp)
- æ¬„ä½ï¼šjob_idï¼ˆå¤–éµå¼•ç”¨ build_jobsï¼‰ã€timestampï¼ˆæ—¥èªŒæ™‚é–“æˆ³è¨˜ï¼‰ã€messageï¼ˆæ—¥èªŒè¨Šæ¯å…§å®¹ï¼‰ã€log_levelï¼ˆæ—¥èªŒç­‰ç´šï¼šnormal æˆ– verboseï¼‰
- ç´šè¯åˆªé™¤ï¼šjob è¢«åˆªé™¤æ™‚è‡ªå‹•åˆªé™¤é—œè¯æ—¥èªŒ
- æ—¥èªŒç­‰ç´šï¼šnormalï¼ˆä¸€èˆ¬æ—¥èªŒï¼Œé è¨­é¡¯ç¤ºï¼‰ã€verboseï¼ˆè©³ç´°æ—¥èªŒï¼Œåƒ…åœ¨è©³ç´°æ¨¡å¼å•Ÿç”¨æ™‚é¡¯ç¤ºï¼‰

**webhooks è¡¨æ ¼ï¼ˆWebhook ç«¯é»è¡¨ï¼‰çµæ§‹ï¼š**

- ä¸»éµï¼šwebhook_idï¼ˆè‡ªå‹•éå¢ï¼‰
- æ¬„ä½ï¼šnameï¼ˆWebhook åç¨±ï¼‰ã€urlï¼ˆç«¯é» URLï¼‰ã€eventsï¼ˆè¨‚é–±äº‹ä»¶æ¸…å–®ï¼‰ã€is_activeï¼ˆæ˜¯å¦å•Ÿç”¨ï¼Œé è¨­ 1ï¼‰ã€secretï¼ˆHMAC ç°½ç« å¯†é‘°ï¼‰ã€headersï¼ˆè‡ªè¨‚ HTTP Headersï¼‰ã€created_byï¼ˆå»ºç«‹è€…ä½¿ç”¨è€…åç¨±ï¼Œå¤–éµå¼•ç”¨ usersï¼‰ã€created_atã€updated_at

**ç´¢å¼•è¨­å®šï¼š**

- idx_job_statusï¼šbuild_jobs çš„ status æ¬„ä½ç´¢å¼•ï¼ˆåŠ å¿«ç‹€æ…‹æŸ¥è©¢ï¼‰
- idx_job_createdï¼šbuild_jobs çš„ created_at æ¬„ä½ç´¢å¼•
- idx_job_motherboardï¼šbuild_jobs çš„ motherboard_model_name æ¬„ä½ç´¢å¼•
- idx_log_jobï¼šjob_logs çš„ job_id æ¬„ä½ç´¢å¼•
- idx_log_timestampï¼šjob_logs çš„ timestamp æ¬„ä½ç´¢å¼•
- idx_webhook_activeï¼šwebhooks çš„ is_active æ¬„ä½ç´¢å¼•

### C. API å®Œæ•´ç«¯é»æ¸…å–®

#### ä»»å‹™ç®¡ç† API

| æ–¹æ³• | ç«¯é» | èªªæ˜ | è«‹æ±‚é«” | å›æ‡‰ |
|------|------|------|--------|------|
| POST | `/api/job` | å‰µå»ºä»»å‹™ï¼ˆå–®ä¸€ä»»å‹™æ¨¡å¼ï¼‰ | `CreateJobPayload` | `{job_id, ...}` |
| GET | `/api/job` | å–å¾—ç•¶å‰/æœ€è¿‘ä»»å‹™ | - | `BuildJob` |
| GET | `/api/queue` | åˆ—å‡ºç­‰å¾…ä½‡åˆ— | - | `{count, jobs[]}` |
| GET | `/api/job/stream` | ä¸²æµæ—¥èªŒï¼ˆSSEï¼‰ | - | Event Stream |
| GET | `/api/job/manifest` | å–å¾— Manifest | - | `{manifest}` |
| POST | `/api/job/cancel` | å–æ¶ˆç•¶å‰ä»»å‹™ | - | `{success}` |
| DELETE | `/api/job` | åˆªé™¤ä»»å‹™ | - | `{job_id}` |

#### ä»»å‹™æ­·å²èˆ‡è¤‡è£½ API

| æ–¹æ³• | ç«¯é» | èªªæ˜ | è«‹æ±‚é«” | å›æ‡‰ |
|------|------|------|--------|------|
| GET | `/api/jobs` | åˆ—å‡ºæ‰€æœ‰ä»»å‹™ï¼ˆæ”¯æ´ç¯©é¸ï¼‰ | Query params | `{jobs[], count}` |
| GET | `/api/jobs/search` | æœå°‹ä»»å‹™ | Query params | `{jobs[], count}` |
| POST | `/api/jobs/{id}/clone` | è¤‡è£½ä»»å‹™ | `{customer_name?, ...}` | `{job_id}` |

#### è³‡æºç®¡ç† APIï¼ˆæ™ºæ…§éæ¿¾ï¼‰

| æ–¹æ³• | ç«¯é» | èªªæ˜ | è«‹æ±‚é«” | å›æ‡‰ |
|------|------|------|--------|------|
| GET | `/api/resources/motherboards` | åˆ—å‡ºä¸»æ©Ÿæ¿ | - | `{motherboards[]}` |
| GET | `/api/resources/motherboards/search` | æœå°‹ä¸»æ©Ÿæ¿ï¼ˆç›¸ä¼¼åº¦è©•åˆ†ï¼‰ | `?query=X13` | `{results[]}` |
| GET | `/api/resources/drivers/recommend` | å–å¾—é©…å‹•æ¨è–¦ | `?motherboard=X13&base_image=...` | `{recommendations[]}` |
| GET | `/api/resources/base-images` | åˆ—å‡ºåŸºç¤æ˜ åƒ | - | `{base_images[]}` |
| GET | `/api/resources/driver-versions` | å–å¾—é©…å‹•ç‰ˆæœ¬ | `?motherboard=X13SAV` | `{versions[]}` |
| GET | `/api/resources/compatible-versions` | å–å¾—ç›¸å®¹ç‰ˆæœ¬ | `?base_image=...` | `{compatible[]}` |
| GET | `/api/resources/langpacks` | åˆ—å‡ºèªè¨€åŒ… | - | `{langpacks[]}` |
| GET | `/api/resources/updates` | åˆ—å‡ºæ›´æ–°æª” | - | `{updates[]}` |
| GET | `/api/resources/software` | åˆ—å‡ºè»Ÿé«”å¥—ä»¶ | - | `{software[]}` |
| GET | `/api/resources/answer-files` | åˆ—å‡ºæ‡‰ç­”æª” | - | `{answer_files[]}` |
| GET | `/api/resources/tools` | åˆ—å‡ºå·¥å…· | - | `{tools[]}` |

#### æ§‹å»ºæ˜ åƒ APIï¼ˆè¼¸å‡ºç®¡ç†ï¼‰

| æ–¹æ³• | ç«¯é» | èªªæ˜ | è«‹æ±‚é«” | å›æ‡‰ |
|------|------|------|--------|------|
| GET | `/api/outputs` | åˆ—å‡ºæ‰€æœ‰å»ºç½®è¼¸å‡ºï¼ˆæ”¯æ´æœå°‹éæ¿¾ï¼‰ | - | `{outputs[], total}` |
| GET | `/api/outputs/{customer}/{job}/manifest` | å–å¾— Manifest å…§å®¹ï¼ˆæ–‡å­—æˆ– JSONï¼‰ | - | `{content, type}` |
| GET | `/api/outputs/{customer}/{job}/download` | ä¸‹è¼‰æ‰“åŒ… ZIPï¼ˆWIM + MD5 + Manifestï¼‰ | - | File Download |
| GET | `/api/outputs/{customer}/{job}/download/wim` | åƒ…ä¸‹è¼‰ WIM æª”æ¡ˆ | - | File Download |
| GET | `/api/outputs/{customer}/{job}/download/checksum` | åƒ…ä¸‹è¼‰ MD5 æ ¡é©—æª” | - | File Download |
| GET | `/api/outputs/{customer}/{job}/download/manifest` | åƒ…ä¸‹è¼‰ Manifest æª”æ¡ˆ | - | File Download |

#### Webhook API

| æ–¹æ³• | ç«¯é» | èªªæ˜ | è«‹æ±‚é«” | å›æ‡‰ |
|------|------|------|--------|------|
| POST | `/api/webhooks` | å‰µå»º Webhook | `{url, events[], ...}` | `{webhook_id}` |
| GET | `/api/webhooks` | åˆ—å‡º Webhooks | - | `{webhooks[]}` |
| PATCH | `/api/webhooks/{id}` | æ›´æ–° Webhook | `{url?, events?, ...}` | `{webhook_id}` |
| DELETE | `/api/webhooks/{id}` | åˆªé™¤ Webhook | - | `{success}` |

#### ç³»çµ± API

| æ–¹æ³• | ç«¯é» | èªªæ˜ | è«‹æ±‚é«” | å›æ‡‰ |
|------|------|------|--------|------|
| GET | `/api/health` | å¥åº·æª¢æŸ¥ | - | `{status, database, version}` |

#### æœå°‹åŠŸèƒ½è©³è§£

`/api/jobs` ç«¯é»æ”¯æ´å…¨æ¬„ä½ç¶œåˆæœå°‹åŠŸèƒ½

**å¯ç”¨æŸ¥è©¢åƒæ•¸ï¼š**

- `search`ï¼šæœå°‹æ‰€æœ‰æ¬„ä½ï¼ˆJob IDã€å®¢æˆ¶åç¨±ã€ä¸»æ©Ÿæ¿å‹è™Ÿã€åŸºç¤æ˜ åƒã€ç‹€æ…‹ã€æ—¥èªŒã€å…ƒä»¶ï¼‰
- `status`ï¼šä¾ç‰¹å®šç‹€æ…‹ç¯©é¸
- `customer`ï¼šä¾å®¢æˆ¶åç¨±ç¯©é¸
- `motherboard`ï¼šä¾ä¸»æ©Ÿæ¿å‹è™Ÿç¯©é¸
- `limit`ï¼šæœ€å¤§çµæœæ•¸ï¼ˆé è¨­ 50ï¼Œæœ€å¤§ 200ï¼‰
- `offset`ï¼šåˆ†é åç§»é‡

**æœå°‹æ“ä½œç¯„ä¾‹ï¼š**

- æœå°‹ "Win11" é—œéµå­—ï¼ˆè·¨æ‰€æœ‰æ¬„ä½ï¼‰ï¼š`curl "http://localhost:5000/api/jobs?search=Win11"`
- æœå°‹ä¸»æ©Ÿæ¿å‹è™Ÿ "X13SAZ"ï¼š`curl "http://localhost:5000/api/jobs?search=X13SAZ"`
- ä¾ç‹€æ…‹ç¯©é¸ï¼ˆå¦‚ Verifiedï¼‰ï¼š`curl "http://localhost:5000/api/jobs?status=Verified"`
- æœå°‹ä¸¦åˆ†é ï¼š`curl "http://localhost:5000/api/jobs?search=CustomerA&limit=10&offset=0"`

**æœå°‹æ¶µè“‹æ¬„ä½ï¼š**

- Job IDï¼ˆæ•¸å­—æœå°‹ï¼‰
- å®¢æˆ¶åç¨±
- ä¸»æ©Ÿæ¿å‹è™Ÿ
- åŸºç¤æ˜ åƒè·¯å¾‘èˆ‡æª”å
- ä»»å‹™ç‹€æ…‹
- è¼¸å‡ºæ˜ åƒè·¯å¾‘
- æ—¥èªŒè¨Šæ¯
- å…ƒä»¶é¡å‹èˆ‡è·¯å¾‘

#### Manifest ç”ŸæˆåŠŸèƒ½

**Manifest ç”Ÿæˆæ–¹å¼ï¼š**

- ç™¼é€ GET è«‹æ±‚åˆ° `/api/jobs/{job_id}/manifest` ç«¯é»ï¼ˆå¦‚ `curl http://localhost:5000/api/jobs/123/manifest`ï¼‰
- ç³»çµ±æœƒç‚ºæŒ‡å®šä»»å‹™ç”Ÿæˆè©³ç´°çš„å®‰è£æ¸…å–®

**Manifest åŒ…å«ï¼š**

- ä»»å‹™å…ƒè³‡æ–™ï¼ˆIDã€å®¢æˆ¶ã€å»ºç«‹æ—¥æœŸã€ç‹€æ…‹ï¼‰
- ç³»çµ±è³‡è¨Šï¼ˆä¸»æ©Ÿæ¿å‹è™Ÿã€åŸºç¤æ˜ åƒã€ç”¢å“é‡‘é‘°ï¼‰
- å…ƒä»¶æ¸…å–®ï¼ˆå«å®‰è£é †åºï¼‰
- å®‰è£æ­¥é©Ÿ
- é©—è­‰æ¨™æº–
- è¼¸å‡ºè·¯å¾‘

### D. æ•ˆèƒ½èª¿æ ¡å»ºè­°

**1. è³‡æ–™åº«å„ªåŒ–**

- ä½¿ç”¨é€£ç·šæ± æé«˜ SQLAlchemy ä¸¦ç™¼èƒ½åŠ›ï¼šæ¡ç”¨ QueuePool ä½œç‚ºé€£ç·šæ± é¡åˆ¥
- SQLAlchemy engine å‰µå»ºé…ç½®ï¼š
  - poolclass è¨­ç‚º QueuePool
  - pool_size è¨­ç‚º 10ï¼ˆåˆå§‹é€£ç·šæ•¸ï¼‰
  - max_overflow è¨­ç‚º 20ï¼ˆè¶…é¡é€£ç·šæ•¸ï¼‰
- å»ºç«‹è¤‡åˆç´¢å¼•åŠ å¿«æŸ¥è©¢ï¼šåœ¨ build_jobs è¡¨æ ¼ä¸Šå‰µå»º (status, created_at) è¤‡åˆç´¢å¼•ï¼Œç”¨æ–¼ç‹€æ…‹èˆ‡æ™‚é–“çš„çµ„åˆæŸ¥è©¢

**2. Worker ä¸¦è¡Œè™•ç†**

- åœ¨ start_all.bat è…³æœ¬ä¸­å•Ÿå‹•å¤šå€‹ Build Processor å¯¦ä¾‹ï¼ˆå¦‚å•Ÿå‹• 3 å€‹å¯¦ä¾‹ï¼‰
- æ¯å€‹å¯¦ä¾‹ç¨ç«‹åŸ·è¡Œ `python workers/build_processor.py`ï¼Œé€éè³‡æ–™åº«ç‹€æ…‹å”èª¿é¿å…é‡è¤‡è™•ç†
- å¤šå¯¦ä¾‹ä¸¦è¡Œè™•ç†å¯é¡¯è‘—æå‡å»ºç½®ååé‡

**3. å‰ç«¯æ•ˆèƒ½**

- ä½¿ç”¨è™›æ“¬åŒ–åˆ—è¡¨ï¼šå°å…¥ @tanstack/react-virtual çš„ useVirtualizer Hookï¼Œåœ¨ Job æ•¸é‡é¾å¤§æ™‚åªæ¸²æŸ“å¯è¦‹é …ç›®
- ç¨‹å¼ç¢¼åˆ†å‰²ï¼šä½¿ç”¨ React lazy() å‹•æ…‹è¼‰å…¥ JobDetail é é¢å…ƒä»¶ï¼Œæ¸›å°‘åˆå§‹åŒ…é«”å¤§å°
- å¿«å–ç­–ç•¥ï¼šé…ç½® TanStack Query çš„ QueryClientï¼š
  - staleTime è¨­ç‚º 30000 æ¯«ç§’ï¼ˆ30 ç§’å…§è¦–ç‚ºæ–°é®®è³‡æ–™ï¼‰
  - cacheTime è¨­ç‚º 300000 æ¯«ç§’ï¼ˆè³‡æ–™åœ¨è¨˜æ†¶é«”ä¸­ä¿ç•™ 5 åˆ†é˜ï¼‰

---

## çµèª

é€™ä»½æ–‡ä»¶æ¶µè“‹äº† WAIT ç³»çµ±çš„å®Œæ•´æŠ€è¡“ç´°ç¯€ï¼ŒåŒ…æ‹¬ï¼š

âœ… ç³»çµ±æ¶æ§‹èˆ‡è¨­è¨ˆç†å¿µ
âœ… æ¯å€‹æ¨¡çµ„çš„è©³ç´°å¯¦ä½œ
âœ… å®Œæ•´çš„è³‡æ–™æµç¨‹åœ–
âœ… Web UI å‰å¾Œç«¯æ¶æ§‹
âœ… éƒ¨ç½²èˆ‡é–‹ç™¼æŒ‡å—
âœ… æ•…éšœæ’é™¤æ–¹æ³•
âœ… å…¨æ¬„ä½æœå°‹èˆ‡ Manifest ç”ŸæˆåŠŸèƒ½

å¦‚éœ€é€²ä¸€æ­¥å”åŠ©ï¼Œè«‹åƒè€ƒï¼š

- è‹±æ–‡æ–‡ä»¶ï¼š`README.md`
- Web UI æ–‡ä»¶ï¼š`web/README.md`
- Issue Trackerï¼š[GitHub Issues](https://github.com/your-org/wiat/issues)

---

## ä½œè€…

**Ben Lin**
Email: <benlin@supermicro.com>

---

Version: 2.0
Last Updated: 2025-01-15
